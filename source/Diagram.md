

# ダイアグラム編
## ダイアグラム共通要素

前述のようにSysMLにはいくつかの種類のダイアグラムがあり、ダイアグラムの種類によって記載できるモデル要素の種類が異なる。
しかし中にはダイアグラムによらず共通して利用できるモデル要素がある。
本章ではそのようなダイアグラム共通のモデル要素について解説する。

## ダイアグラム共通要素の例

図2.1は、ダイアグラム共通のモデル要素を含むブロック定義図(図1-4の再掲)である。
本章ではこの図を題材としてモデル要素の解説を行なう。

## フレーム


図2.1では、ダイアグラム全体を図2.2のような矩形で囲むことで、ダイアグラムの範囲を示している。
このように、ダイアグラムの範囲を示すための矩形をフレームと呼ぶ。
図2-2のように、フレームの左上の部分にはヘッダと呼ばれる箇所があり、ここにダイアグラムの名称等の情報を記載する。
ヘッダには以下のような形式で情報を記載する。

`ダイアグラム種別[モデル要素種別] モデル要素名[ダイアグラム名]`

ダイアグラム種別には、表2.1に示すような名称または略称を指定できる。
ダイアグラム種別はボールド体で表記する。
モデル要素種別やモデル要素名は、そのダイアグラムのフレーム全体で表現するモデル要素を特定するために指定する。
例えば図2.2の例では、ダイアグラムが「コピー機」パッケージの構造を表現していることを示している。
各種ダイアグラムのフレーム全体で記述できるモデル要素の種類の例を表2.2に示す。
ヘッダの情報のうち、ダイアグラム種別とモデル要素名の指定は必須である。
モデル要素種別やダイアグラム名は、あいまいさを無くすために必要に応じて指定する。
1つのモデル要素に対して複数のダイアグラムがある場合、ダイアグラム名を指定することでダイアグラムを一意に特定できるようになる。

### コメント

図2.1では、コピー機制御部がコピーのための各種処理を実行するハードウェアに指示を行なうことを図2.3のように示している。
このように、モデル要素に対して任意の文字列を付加することで、モデルに情報を追加するためのモデル要素をコメント(Comment) と呼ぶ。
図2.3のようにコメントは、ノートと呼ばれる右上の角の曲がった矩形の中に文字列を記載して表現する。
コメントの対象となるモデル要素を示すために、そのモデル要素とノートの間を破線で接続して表現できる。
ノートは制約や根拠(Rationale)、問題(Problem) 等を表現するためにも使用される。
根拠や問題については第6章「要求図」で後述する。

### ステレオタイプ

第1章で述べたように、SysMLはUMLをベースとした言語である。
SysMLの多くのモデル要素が、UMLのモデル要素を元に拡張することによって定義されている。
図2.1では、UMLのクラスというモデル要素を拡張して定義されたブロックというSysMLのモデル要素を、図2.4のように表記している。
このように、UMLのモデル要素を元に、特定の用途のために拡張して定義したモデル要素を、ステレオタイプ(Stereotype)と呼ぶ。
ステレオタイプを表記するには、図2.4のように要素にステレオタイプ名を表記する方法の他に、ステレオタイプ用のアイコンを定義し、アイコンでステレオタイプを表現する方法がある。

## ブロック定義図

他の章で解説する内部ブロック図、パラメトリック図等、いくつかの図を記述する上で、別
途「型」を定義しておくことが必要である。
本章では、型を定義するための図であるブロック
定義図について解説する。

### ブロック定義図とは

ブロック定義図(Block Definition Diagram) と内部ブロック図(Internal Block Diagram)は構造図として位置づけられ、システムの構造を表現するために利用される。
構造図を用いて、システムをその構成要素のツリー構造として表現することを始め、構成要素間の種々の関係を表現できる。

本章で解説するブロック定義図は、特にシステムを構成する要素の型(Type) を定義するために利用される。では、ここで言う「型」とはどのようなものだろうか。
例として、「田中さんのマイカー」、「佐藤さんのマイカー」といった、いくつかの実在の自動車を考えてみよう。
そしてこれらの自動車を分類してみて欲しい。
セダン、ハッチバックといった車体の形状に着目した分類や、FF、FRといった駆動方式に着目した分類等、いくつかの分類方法があることに気付くだろう。
得られたこれらの分類に対して、各々どのような特性を持っているかを考えてみて欲しい。
それまで漠然としていた「自動車」に対する捉え方が、徐々に明確なものになってきたのではないだろうか。
この例では、「田中さんのマイカー」が実際の物理的な物であるのに対して、「セダン」「FF」等は物の特性を表す型とみなすことができる。
型に着目して物事を掘り下げていくことは、すなわち物事を分析し、明確化することだと言えるだろう。

このように型に着目しながらシステムやその構成要素を表現する上で、ブロック定義図を活用できる。
ブロック定義図で利用可能な型にはいくつかの種類があり、後述のブロックや値型等が含まれる。
ブロック定義図は、言語仕様上UMLのクラス図をベースとしており、クラス図で使える言語要素の多くをブロック定義図でも使うことができる。

### ブロック定義図の例

ブロック定義図について説明するための題材として、図3.2のようなロケットを考えてみよう。

図3.4は、より多くの種類のモデル要素を用いて、ロケットの構造の概略を表現したブロック定義図である。
以降、図3.4のブロック定義図をもとに、各モデル要素について説明していく。

### ブロック

ブロック(Block): システムやその構成要素を表現するための単位。

*補足*
- ブロックは、システムをその構成要素に分解することや、それら要素を分類することによって得ることができる
- ブロックを使って、システムを構成単位のツリー構造として表現できる
- ブロックは型の一種であり、プロパティや操作等、後述するような様々な情報をブロックに付加することで、ブロックをより詳細に表現できる
- ブロックの表記ではステレオタイプ名≪ block ≫を用いる。ただしブロック定義図の中で≪ block ≫の表記を省略してもデフォルトでブロックと見なされるため、表記を省略しても構わない

*例*

図3.4のブロック定義図では、ロケットのようなシステムや、その構成要素であるロケットエンジン等を表す単位を、図3.5のように表現している。


### 関連(Association)

図3.4のブロック定義図では、推進部と被運搬部の間に、「推進部が被運搬部に推力を加える」関係があることを図3.7のように表現している。
このように、2つのブロックの間の関係を表現するためのモデル要素が、関連(Association) である。
関連でつながれた一方のブロックが関連名の主語に当たる場合には、黒い三角形で関連の作用する方向を表現できる。
また、「～を加速する」のように関連につながるブロックの一方が目的語に当たる場合には、より簡単に「加速する」と表記できる。

図3.7は推進部と被運搬部の意味的な関係を表現したやや抽象的なモデルだが、関連を使ってより物理的な関係を表現できる。
図3.8は推進部と被運搬部の間の物理的な接続関係を表現したモデルの例である。
後述のパート関連や共有関連のように特別な意味を持つ関連と異なり、図3.7のようにブロック間の単純な参照関係を表現するための関連を、参照関連(Reference Association) と呼ぶ。

### 関連端

図3.4では、「～に推力を加える」関係において、推進部は「推進元」として働き、被運搬部は「作用先」として働くことを図3.9のように表現している。
このように、関連の表す文脈において、関連につながるブロックが果たす役割を表現するモデル要素が、関連端(AssociationEnd) である。

### 誘導可能性

図3.4では、コア機体と固体燃料ブースターの間の関係について、コア機体から固体燃料ブースターを参照するが、逆に固体燃料ブースターからコア機体は参照しないことを図3.10のように表現している。
このように、関連でつながれた一方のブロックから、もう一方のブロックを参照できるかどうかを表すモデル要素が、誘導可能性(Navigability) である。
図3.10では単方向のみ参照が可能なため、関連の一端に矢印を表記している。
これに対して双方向とも参照が可能な場合には、図3.7のように矢印を表記しない。

### 多重度(Multiplicity)

多重度(Multiplicity): 関連でつながれた一方のブロックのインスタンス1つに対して、もう一方のブロックのインスタンスがいくつ対応するかを表す

*補足*

- 多重度の表記で、「0..*」のように文字「*」を使うと上限の指定のないことを意味する。
- また多重度として文字「*」のみを単独で指定した場合は、「0..*」と同じ意味になる。
- 誘導可能性が単方向のみの関連において、参照される側の多重度を省略すると、デフォルト多重度「1」が適用される
- 後述のパート関連や共有関連では、菱形側のデフォルト多重度は「0..1」

*例*

図3.4では、コア機体と固体燃料ブースターの間の関係について、1つのコア機体に対し固体燃料ブースターを最大4基まで装備可能であることを図3.11のように表現している。
装備可能な下限は0基であり、すなわちブースターを装備しない場合もあることを表している。


図3.12では、荷載部に対するフェアリングの多重度は示されていない。
このように誘導可能性が単方向のみの関連において、参照される側の多重度を省略すると、デフォルト多重度「1」が適用される。
この場合1つの荷載部に対してフェアリングは1つ対応することを意味する。
なお後述のパート関連や共有関連では、菱形側のデフォルト多重度は「0..1」である。

### パート関連

図3.4では、ロケットと推進部の間の関係について、推進部がロケットの一部であることを図3.13のように表現している。
このように、全体と部分との関係を表現する関連がパート関連(Part Association) である。
パート関連には以下のような制約がある。

- パート関連で表現された「全体-部分」関係において、部分は同時に複数の全体に属することはできない。
- パート関連における全体が削除されると、部分も同時に削除される。


図3.4では、推進部がコア機体、ロケットエンジン、固体燃料ブースターから構成されていることを図3.14 のように表している。
このように、ある1つのブロックをパート関連の一端（全体側）とする関係が複数ある場合に、パート関連の一端をまとめて表記できる場合がある。
このように表記したパート関連を、多分岐パート関連(Multibranch Part Association)と呼ぶ。
関連の一端をまとめて表記するには、まとめられる側の関連端の情報（関連端名、多重度、誘導可能性等）が一致している必要がある。

### 共有関連

図3.4では、ロケットと被運搬部の間の関係について、被運搬部がロケットの一部であること、ロケットが破棄されても被運搬部は運用が継続されることを、共有関連(Shared Association) を用いて図3.15 のように表現している。
共有関連は、厳密な意味を定められているわけではなく、モデリングの状況に応じて意味を決めて利用するための関連である。
「3.4.4 パート関連」と同様、共有関連についても、関連の一端をまとめて表記できる。
これを多分岐共有関連(Multibranch Shared Association) と呼ぶ。

### 関連ブロック

図3.4では、液体燃料タンクとロケットエンジンの関係について、液体燃料タンクからロケットエンジンに液体燃料が供給される関係があること、燃料供給量のような情報が伴うことを図3.16 のように表現している。
このように、関連だけでなくブロックの性質を合わせ持つことで、単なる関連よりも多くの特性を表現できるモデル要素を、関連ブロック(Association Block) と呼ぶ。
関連ブロックは、関連であると同時にブロックでもあるため、後述のようなプロパティや操作等、通常のブロックと同様の要素を保持できる。

### 区画

図3.17では、図3.4の「推進部」ブロックに付随する様々な特性を表現している。
このように、ブロックの特性を様々な形式で表現する際に、区別して表記するための領域を区画(Compartment)と呼ぶ。
SysML ではいくつかの標準的な区画を規定している。
また利用者が区画を定義して利用できる。
ブロックの矩形に各種区画を表記する順序は任意である。
区画中に区画名を表記して、種類を明示的に区別しても良い。

### プロパティ

図3.18 では、図3.4 の「ロケットエンジン」ブロックが保持する情報を区画中に表現している。
このように、ブロックが保持する情報がプロパティ(Property) である。

プロパティは、ブロックの区画中に以下のような形式で表記できる。

`プロパティ名: 型[多重度] = デフォルト値{ プロパティ修飾子}`

- 上記の形式の中で、プロパティ名以外は省略して表記できる。
- 多重度の表記を省略した場合は、多重度は1と見なされる。


##### 利用可能なプロパティ修飾子の例

|プロパティ修飾子|意味|
|:---:|:---:|
|readOnly|プロパティは読み取り専用|
|ordered|プロパティは順序付けられている|
|unique|プロパティに重複がない|

`記述例：`

`補助推進: 固体燃料ブースター[0..4]`

`推力: kN = 2000`

`ペイロードID : Integer { unique }`

「3.4.1 関連端」の関連端もプロパティの一種である。
例えば、図3.9 において、関連端「作用先」はブロック「推進部」が保持するプロパティである。

### 分布プロパティ

図3.4では、固体燃料ブースターの推力の確率分布が正規分布であることを図3.19のように表現している。
このように、値の確率分布を指定できるように拡張されたプロパティを、分布プロパティ(Distributed Property) と呼ぶ。
各種分布プロパティを、表3.2に示す。
分布プロパティの記述例を以下に示す。
　
`記述例：`

`{ mean=2500, standardDeviation=0.8 } 推力: kN`

`≪ interval ≫ { min=101.0, max=105.0 } 体積: m^3`

`≪ uniform ≫ { min=87, max=92 } 速度: mph`

記述例のように、分布プロパティの種類がNormal の場合にはパラメータの種類で判別できるが、Interval とUniform はパラメータの種類が同じであるため、ステレオタイプを明示して区別する。

|ステレオタイプ|パラメータ名称|型|意味|説明|
|---|---|---|---|---|
|≪Interval≫|min|Real|最小値|値はminとmaxの間に分布する。min及びmaxも範囲に含む。確率分布は指定しない。|
|↑|max|Real|最大値|↑|
|≪Uniform≫|min|Real|最小値|値はminとmaxの間に分布する。min及びmaxも範囲に含む。確率分布は一定。|
|↑|max|Real|最大値|↑|
|≪Normal≫|mean|Real|平均|値の確率分布は正規分布に従う。|
|↑|standardDeviation|Real|標準偏差|↑|

### プロパティ用区画

「3.5.1プロパティ」のように、プロパティをブロックの区画中に表記できる。
表3.3は、プロパティを表現する上で利用できる区画である。

|区画名|説明|
|---|---|
|values|値型（「3.7 値型」で後述）を型とするプロパティのための区画|
|parts|パート関連で保有するブロックを型とするプロパティのための区画|
|references|参照関連で関係付けられたブロックを型とするプロパティのための区画|
|properties|プロパティ全般を区別なく表記するための区画|

### 制約区画(Constraints Compartment)

図3.4では、推進部全体の推力の合計（総推力）が、ロケットエンジンの推力の合計と、固体燃料ブースターの推力の合計の和に等しくなるという制約があることを図3.20 のように表現している。
このように、モデル要素の間にある制約を表現するための区画が、制約区画(Constraints Compartment) である。
制約区画に記述する制約は、一般的なテキストベースの書式による制約の記述を波括弧で囲った形式で表現する。
区画の中に制約を複数記述しても良い。
図3.20の例では、SysML と同様OMG (Object Management Group) によって仕様が策定されたOCL (Object Constraint Language) を用いて制約を表現している。
制約を表現する上で、区画に記載せずにノート（「2.3 コメント」参照）を使うこともできる。
図3.21 は、ノートを使って制約を表現した例である。

### 名前空間区画

図3.22 では、「荷載部」ブロックが他のいくつかのブロックの定義を包含していることを、図3.4 とは異なる形式で表現している。
このように、あるブロックが別のモデル要素の定義を包含しているときに、包含されたモデル要素をグラフィカルに表現するための区画が、名前空間区画(Namespace Compartment) である。
名前空間区画には、ブロック定義図で利用可能な様々なモデル要素を表記できる。
名前空間区画を使って、モデル要素の定義の包含関係を表現できるが、これはあくまでモデル要素の定義がどこに属するかの問題であり、ブロック間の「全体-部分関係」等とは異なるので注意されたい。

### 構造区画

図3.23 では、「推進部」ブロックがいくつかの要素から構成されていることを、図3.4 とは異なる形式で表現している。
このように、ブロックを構成する要素を表現するための区画が、構造区画(Structure Compartment) である。
構造区画では、第4 章で解説する内部ブロック図で利用可能な多くのモデル要素を使うことができる。
これらのモデル要素の詳細について詳しくは第4 章「内部ブロック図」や第5章「ポートとフロー」を参照されたい。

### 操作区画

図3.4 では、ロケットエンジンが「点火する」振る舞いを持つことを、図3.24 のように表現している。
このように、ブロックの振る舞いを表すモデル要素が、操作である。
そして操作を表記するためのブロック中の区画が、操作区画(Operations Compartment) である。
操作区画には以下のような形式で操作を表記できる。

##### 操作の形式

`操作名( パラメータリスト) : 返却値型`

返却値型は省略して表記できる。
パラメータリストは、パラメータをカンマ区切りで表記する。
パラメータの形式は以下の通りである。

##### パラメータの形式

`方向パラメータ名: 型名= デフォルト値`

上記のうち、パラメータ名以外は省略して表記できる。
方向には、in, out, inout を指定できる。
各々、入力パラメータ、出力パラメータ、入出力パラメータを意味する。
以下に、操作の記述例を示す。

`記述例：`

`点火する()`

`ブースターを分離する(bids : ブースターID リスト) : 結果`

`燃料を供給する(in tid : タンクID = 1, in amount : tps, out prevResult : tps) : 結果`

### 汎化

図3.4 では、ロケットによって運搬される被運搬部の種類として、荷載部とロケット（この場合第2段ロケット）があることを、図3.25 のように表現している。
ここで被運搬部は、ロケットによって運搬される部分を抽象的に表した概念である。
このように、相対的に具象的なブロックと抽象的なブロックとの関係を表現するためのモデル要素が、汎化(Generalization)である。
具象的なブロックのインスタンスは、そのブロックと汎化関係のあるより抽象的なブロックの特性を受け継ぐ。
汎化はしばしば物事の体系的な分類のために利用される。
また図3.25 では、被運搬部が抽象的な概念であり、実体はあくまでロケットや荷載部であることを表現している。
このように、直接インスタンス（実体）の型になることのないブロックに対し、抽象指定{abstract} を設定する。
抽象指定されたブロックは、直接インスタンス化されない代わりに、汎化関係のあるより具象的なブロックがインスタンスの型となる。
抽象指定されたブロックの名称はイタリック体で表記する。

### 値型

図3.4 の中では図3.26 のように、ロケットエンジンの推力の値を単位「kN」を表す型で扱っている。
このように、値の型を定義するためのモデル要素が、値型(Value Type) である。
値型で型付けられた情報は、参照を介して扱われることはなく、値としてのみ扱われる。
このため値型は参照関連による参照先となることはない。
値型を定義する際には、図3.27のようにしばしば単位や量種別を利用する。

図3.27では、値型kN を単位「キロニュートン」を使って定義している。
このようにモデル要素「単位」(Unit) を使って、値型の定義で用いる単位を指定できる。

また図3.27では、単位「キロニュートン」が量種別「力」を使って定義されている。
このように、単位や値型がどのような種類の量を表すかを定義するためのモデル要素が、量種別(Quantity Kind) である。
単位や量種別は型ではないため、ブロックのプロパティや操作のパラメータのための型として直接利用できない。
そのような目的には値型を定義して利用する。
図3.27の値型の定義では、ステレオタイプ≪ valueType ≫ を修飾するための値を、ステレオタイプ・プロパティ区画(Stereotype Property Compartment) の中に名前と値の組で表
記している。ここでは名前「unit」とその値「キロニュートン」を指定しているが、値型の定義にはこの他に名前「quantityKind」とその値を指定できる。
一方、単位の定義では「quantityKind」を指定している。
これら「unit」や「quantityKind」の指定はいずれもオプションであり、省略できる。
図3.27 の値型や単位の定義では、要素名のための最上位の区画でステレオタイプ名≪valueType ≫ や≪ unit ≫ の表記を省略しているが、表記しても良い。
値型は、プロパティや操作を持つこともできる。
図3.28 は、SysML のモデルライブラリに含まれている、実数(Real) や複素数(Complex)を表す値型の定義である。
SysML の利用者は、これらの値型を使ってモデリングできる。

## 内部ブロック図

本章では、システムの構造や、構成要素間の関係を表現するための図である、内部ブロック図について解説する。

### 内部ブロック図とは

内部ブロック図(Internal Block Diagram) は、第3章で解説したブロック定義図(BlockDefinition Diagram) と共に構造図として位置づけられ、システムの構造を表現するために利用される。
構造図を用いてシステムをその構成要素のツリー構造として表現したり、構成要素間の関係を表現したりできる。
ブロック定義図は要素の型を表現することで、各要素の種々の仕様を示すことに適している。
これに対し本章で解説する内部ブロック図は、要素間の接続関係を表現するとともに、構成要素の役割や利用方法を表現するために利用される。
では、ここで言う「役割」とはどのようなものだろうか。

例えば、自動車を複数の部分に分解することを考えてみて欲しい。自動車は、エンジンや足回り等、いくつかの部分に分解して捉えることができる。
そして足回りを更に分解してホイール、サスペンション等に分けることができる。
分解の結果得られた複数のホイールは、個々のホイールに着目すればどれも同じであるかもしれない。
しかし前輪と後輪ではホイールの働きが異なる場合がある。
例えば、前輪のみが駆動輪として機能する場合、後輪と異なり、前輪のみに駆動力を伝達することになる。
このような構造を表現するためには、ホイールそのものを表現したり、4つの個々のホイールを個別に表現するよりも、「前輪」「後輪」といった役割に着目して構造を表現することが、システムの構造の特徴を表現する上で効果的と考えられる。
このように、システムの各部分の役割を明確にしながら、システムをより細かい単位に分解していくことは、すなわちシステムの構造を明確化、具体化していくことだといえるだろう。

### 内部ブロック図の例

第3章に続き、本章も図4.1 のようなロケットを題材として考えてみよう。

このロケットの構造の概略を表現する内部ブロック図を、図4.2 に示す。

図4.2 では、ロケットが2段式になっていて第1段推進部、第1段推進部や荷載部といった部分から構成されることや、それら構成要素の内部構造を示している。
以降、図4.2 をもとに、各モデル要素について説明していく。

### プロパティ

図4.2 では、ここで取り上げる2段式のロケットに関係する要素として、第1段推進部、第2段ロケットや発射台があることを図4.3 のように表現している。
このように、ブロックに関係する要素についての情報を表すモデル要素を、プロパティ(Property) と呼ぶ。
プロパティは、要素そのものというよりも、ブロックから見た要素の役割や利用方法を表す。図4.4 を見てみよう。

4.2 では、ロケットエンジンが主推進としての役割を果たしていることを図4.4 のように表現している。
このように、プロパティはブロックのような型や具体的な物等ではなく、あくまで役割を表すモデル要素である点に注意して欲しい。
前述の「前輪」「後輪」の例のように、プロパティを使って要素の役割を表現することで、システムの構造を効果的に表現できる。
プロパティの矩形内には、第3 章「ブロック定義図」で解説したのと同様、プロパティに関する以下のような情報を記載できる。

`プロパティ名: 型[多重度] = デフォルト値{ プロパティ修飾子}`

上記情報の記載方法について詳しくは、「3.5.1 プロパティ」の項を参照されたい。
図4.4 では、上記記載方法における多重度の表現とは異なる形で多重度を表現している。
このように、プロパティの多重度は矩形内の右上に表記できる。

### パート・プロパティ

図4.4 で示した「主推進」プロパティは、図4.2 の中で「第1 段推進部」の一部分として表現されている。
このように、全体-部分関係において、全体を構成する一部分を表すプロパティをパート・プロパティ(Part Property) と呼ぶ。
図4.4 のように、パート・プロパティは内部ブロック図の中で実線で描かれた矩形として表記する。
パート・プロパティは「パート」という略称で呼ばれることもある。

4.5 は図4.4 に示したパート・プロパティに対応する情報を示したブロック定義図である。
このように、パート・プロパティはブロック定義図のパート関連の関連端に対応する。

### 参照プロパティ

図4.2 では、発射台はロケットの一部ではないが、電力供給元としてロケットと関係があることを図4.6 のように表現している。
このように、ブロックと関係するがブロックの一部ではない要素を表すプロパティを、参照プロパティ(Reference Property) と呼ぶ。
図4.6 に示すように、参照プロパティは内部ブロック図の中で破線で描かれた矩形として表記する。

図4.7 は図4.6 に示した参照プロパティに対応する情報を表現したブロック定義図である。
このように、参照プロパティはブロック定義図の参照関連の関連端に対応する。

### その他の種類のプロパティ

プロパティには、前述のパート・プロパティ、参照プロパティの他に、値プロパティ、制約プロパティといった種類がある。

値プロパティ(Value Property) は、値型で型付けされたプロパティである。
パート・プロパティと同様に実線の矩形として表記する。
値プロパティの使用例や制約プロパティについては、第7 章「パラメトリック図」で後述する。

### プロパティ固有型

図4.2 では、ある種のペイロードをロケットの荷載部に搭載することを、図4.8 のように表現している。
ここで搭載するペイロードのための型は、ブロック定義図で別途定義されているわけではない。
このように、ブロック定義図で新たに型を定義することなく、内部ブロック図の中で特定のプロパティ専用に定義する型を、プロパティ固有型(Property-specific Type)と呼ぶ。
図4.8 に示すように、プロパティ固有型はプロパティの型名を角括弧で囲うことで表現する。
このとき、プロパティ固有型は角括弧で囲われた型（この場合「ペイロード」）を拡張した型として定義される。
すなわち、この場合「ペイロード」が持つプロパティや操作といった特性は、プロパティ固有型のインスタンスの特性となり、加えて「上限許容温度」等のプロパティがプロパティ固有型のインスタンスの特性として追加されることになる。

図4.9 は、既存の型をベースとせずに、新規にプロパティ固有型を定義した例である。
図4.9 に示すように、角括弧の間に型名を指定しなければ、既存の型をベースとしない、新規のプロパティ固有型となる。
またこの場合、コロンや角括弧を省略しても同様の意味になる。

### プロパティのネスト表現

図4.10 は、「主推進」プロパティが複数の段階の関係を経てロケットに属していることを表現している。

図4.10 のような複数段階の関係は、図4.11 のように簡略化して表記できる。
この場合、各段階のプロパティ名をドット区切りでつなげて表記する。
もし複数段階の中のいずれかのプロパティが参照プロパティであれば、矩形は点線で表記する。

### 区画

ブロック定義図中のブロックと同様、内部ブロック図中のプロパティにも、区画(Com-partment) を表記できる。
プロパティの区画の種類としては、SysML で規定された標準の区画以外に、利用者が定義した区画を利用できる。
区画に表記する各種情報は、プロパティを型付けするブロックや値型等の型の定義に沿ったものでなければならない。
ただし前述のプロパティ固有型の場合は、型が別途定義されるわけではないため、この限りではない。

### 初期値区画

図4.2 では、液体酸素タンク内の液体燃料の重量が83t であることを図4.12 のように表現している。
一方、液体酸素タンクの型である「液体燃料タンク」ブロックでは、図4.13 のように「液体燃料重量」プロパティのデフォルト値を90t と定義している。
このように、ブロックの定義において指定された値を上書きして、プロパティの値を指定するための区画を、初期値区画(Initial Values Compartment) と呼ぶ。
複数段階ネストされたプロパティの中で初期値区画を設定した場合、最も外側のブロックにおける特定の利用方法を表現したことになる。
すなわち図4.2 や図4.12 の例では、液体燃料重量が83t であることは、最も外側のブロックであるロケットに特有の事柄であることを意味する。
液体水素タンクやコア機体等で常に成立する事柄ということではない。

### 型の区画の表記

図4.2 では、第1 段推進部に制約が対応付いていることを、図4.14 のように「推進部」ブロックの制約区画を使って表現している。
このようにプロパティには、そのプロパティの型の区画を表記できる。
このとき、その区画が型の区画であることを明示するために、区画名の先頭にコロン「:」を付加する。
図4.14 の例では制約区画のラベル「constraints」の前にコロンを付加して表記している。

### コネクタ

図4.2 では、第1段推進部と第2段ロケットの間が接手と呼ばれる機構で接続されていることを、図4.15 のように表現している。
このように、プロパティの間の関係を定義するためのモデル要素を、コネクタ(Connector) と呼ぶ。
コネクタの型を定義する場合は、ブロック定義図の中で関連として定義する。ただしコネクタに対応する関連の定義は必須ではない。
関連が、関連名や関連端名といった情報を伴うのと同様に、コネクタはコネクタ名やコネクタ端名といった情報を伴う。
コネクタ名の表記方法には以下のようないくつかのバリエーションがある。

##### コネクタ名の記法のバリエーション

`コネクタ名: 関連名`

`：関連名`

`コネクタ名`

関連と同様、コネクタにも多重度を指定できる。
ただしコネクタの多重度は、関連の多重度ほど一般的に使われるわけではない。

### コネクタ・プロパティ

図4.2 では、液体水素タンクと主推進の間の接続関係を、図4.16 のように表現している。
図4.16 の関係に対応するブロック定義図は、図4.17 のように関連ブロックを用いて表現する。

このように、関連ブロックのインスタンスであるコネクタを、コネクタ・プロパティ(Connector Property) と呼ぶ。
コネクタ・プロパティは、図4.18 のように≪ connector ≫を付加してブロックの区画の中に表記できる。

#### 参加プロパティ

図4.19 は、図4.2 に示した「液体水素供給」コネクタ・プロパティの型である、「液体燃料供給」関連ブロックの内部構造を表現している。
このような構造を持った関連ブロックを、複数のコネクタの型として再利用できる。
図4.19 では、液体燃料タンクやロケットエンジンが「液体燃料供給」関連ブロックの端に接続されていることを示している。
このように、関連ブロックの内部構造の表現の中で、その関連ブロックの関連端に接続された対象を表わすプロパティを、参加プロパティ(ParticipantProperty) と呼ぶ。
参加プロパティを表記する際には、型の情報は省略できる。

## ポートとフロー

本章では、内部ブロック図やブロック定義図の中でシステムの構成要素の接続点を表すポートや、様々なものの流れを表すフローについて解説する。

### ポートとは

ポート（Port）とは、ブロック定義図や内部ブロック図に登場するモデル要素である。
ポートは、ブロックやパート（パート・プロパティの略称）等、システムの構成要素に属していて、構成要素とその外部との相互作用のための接続点として機能する。
相互作用のための接続点をポートとして明確に定義することによって、構成要素の再利用をより容易にできる。
例えば、目覚まし時計に搭載する電池について考えてみて欲しい。
電池は、電池外部との接続点となる正極・負極において一定の電圧を出力することで、目覚まし時計の内部に電力を供給する。
この電池は、出力電圧や形状が同等の別の電池と交換できる。
このとき、重量や容量といった他の特性が異なる電池であっても、代替の電池として使うことができる。
またこの電池は、同じ出力電圧、同じ形状の電池を必要とする懐中電灯等にも搭載できる。
このように、システムの構成要素が外部と相互作用するための接続点の仕様を明確にすることで、構成要素を別のものと交換したり、構成要素を他の環境で再利用したりすることが容易となる。

### フローとは

一般にシステムの内部では、その構成要素間においてデータ、材料、エネルギー等様々なものの流れを扱わなければならない。
フローとは、このようなシステムの構成要素間の"物や情報等の流れ" を扱うための概念である。
SysML では、フローを構成する単一の要素をフロープロパティ(Flow Property) として表現し、ブロックやポート等の関連するモデル要素と組み合わせることで、システムの構成要素間のフローをモデル化できる。

### ポートとフローの例

ここでは、バイナリーサイクル地熱発電所を題材として解説する。
バイナリーサイクルは、ペンタン等、水よりも沸点の低い媒体を利用することによって、地下の温度が比較的低温な場所であっても発電を可能とする地熱発電方式である。
バイナリーサイクル地熱発電所の中では、蒸気の熱で気化したペンタンがタービンを回して発電したり、冷却されて液化したりしながら循環している。
バイナリーサイクル地熱発電所の構造を表す内部ブロック図を図5.1 に示す。

以降、図5.1 をもとに、ポートや関連するモデル要素について説明していく。

### ポートの種類

SysML には、ポート(Port)、代理ポート(Proxy Port)、完全ポート(Full Port) という3 種類のポートがある。
最も基本的なものがポートで、これは他との区別のためにステレオタイプのないポート(Unstereotyped Port) と呼ばれることがある。
代理ポートと完全ポートは、ステレオタイプのないポートを拡張したものである。*1
代理ポートは、そのポートを所有するブロックが持つ特性またはそのブロックの内部パートがもつ特性を代理で外部に公開するポートである。
完全ポートはそれ自体が独立したシステムの要素として独自の特性をもつポートである。

ステレオタイプのないポートは、代理ポートと完全ポートの基本的な機能を備えている。
ステレオタイプのないポートは後で説明するフロープロパティやネストポートの機能も含んでいるため、モデラーはまずポートを使ってモデリングしておき、あとでモデルを詳細化する際にそのポートを代理ポートとするのか完全ポートとするのかを決めてもよい。
そこでまずは、全てのポートに共通する内容について一通り解説し、次いで各ポート特有の内容を解説する。
　ポート間のやり取りを表現する上で、後述するような様々な表現方法を利用できるが、それらの使い分け方は、手法や考え方に依存して変わってくるだろう。
状況に応じて利用方法を検討されたい。

### ポート

図5.1 では、変圧器に対して電圧管理が可能であることや、タービンに高圧の気体が入り、低圧の気体とトルクが出力されることを図5.3 のように表現している。
このように、システムの構成要素において、様々なデータ、材料、エネルギー等が出入りする接続点を、ポートと呼ぶ。
ポートは図5.3 の変圧器の例のようにブロックまたはパートの境界上の正方形として表記する。
またタービンの例のようにポートがフローを中継している（ポートにフロープロパティがある）場合には、正方形内部にフローの方向を示す矢印を記載する。
ブロック定義図または内部ブロック図中のポートの付近には以下のような形式でラベルを記載する。
ポートは、ブロックや値型、シグナルで型付けできる。

`ポート名: 型名`

図5.3 に登場しているポートは、変圧器の電圧管理用のポートを除いて、全てフロープロパティがあるポートである。
フロープロパティがあるポートは、そのポートの所有者であるブロックに対する入力、出力、入出力のいずれかを表現する（表5.1 参照）。

|入出力方向|定義|
|---|---|
|入力(in)|ポートの型がもつ全てのフロープロパティが入力方向|
|出力(out)|ポートの型がもつ全てのフロープロパティが出力方向|
|入出力(inout)|ポートの型がもつ全てのフロープロパティが入出力方向、または入出力方向が異なるフロープロパティが混じっている|

図5.3 では、入力と出力の場合を矢印の向きで表している。
入出力の場合は、図5.4 のように互いに反対向きの2 つの矢印の頭を用いる。

図5.4 は、図5.1 全体で表現している「バイナリーサイクル地熱発電所」ブロックをブロック定義図の形式で示したものである。
バイナリーサイクル地熱発電所に対して冷却用気体が入力され、かつ出力されることを示している。
ブロック定義図ではポートをグラフィカルに表記するだけでなく、図5.5 のようにports 区画中に記載できる。
この場合、ポート名の左側に入出力の方向を表すin（入力）、out（出力）、またはinout（入出力）のいずれかを記載する。
この入出力方向の定義は表5.1と同じである。

また、ブロック定義図では図5.6 のようにポートを関連端として記載できる。
この場合、ポートはそのポートを保持するブロックの反対側の端に、他の関連端と同じ書式で記載する。

### フロープロパティ

ポートを型付けるブロックにフロープロパティを記述することで、ポートが中継する流れの入出力仕様を表現できる。
図5.1 では「冷却水仕様」というブロックで型付けされたポートが使われている。
このブロック「冷却水仕様」を図5.7 のようにブロック定義図で定義する。

フローの入出力の仕様はフロープロパティの集合として定義する。
既に述べた通りフロープロパティはポートが中継する単一の要素を表す。
ブロックはフロープロパティを保持できる。
フロープロパティは、入力（in）、出力（out）、入出力（inout）のいずれかの方向を持つ。
フロープロパティを表記するには、図5.7 のようにブロックにflow propertiesという区画を設けて表記する。
「冷却水仕様」の例では、「未使用冷却水」と「使用済み冷却水」という2 つのフロープロパティを定義している。
これは、1つの「冷却水仕様」型のポートを介して2種類の冷却水が中継されることを表現している。

### 提供特性と要求特性

ブロック間のフローの方向は、フロープロパティの入出力方向を使って表現できるのに対し、ブロック間の操作、シグナル受信、フロープロパティ以外のプロパティといった特性のやり取りの方向は、特性の提供と要求という方向を使って表現できる。

図5.1 では、集中管理室が変圧器の電圧管理を行なう関係を図5.9 のように表現している。
図5.8 は、「電圧管理」ブロックの定義を示したものである。
図5.8、図5.9では、集中管理室が変圧器を操作する際、目標電圧を設定することを示している。
また変圧器が集中管理室に対して、実際の出力電圧やタップ（巻線上の接続ポイント）の位置情報を通知することを示している。
特性の提供と要求の方向には、その特性の所有者であるブロックに対する提供（prov）、要求（reqd）、または提供要求（provreqd）のいずれかを指定できる。
これらの方向を持った特性を、各々提供特性(Provided Feature)、要求特性(Required Feature)、提供要求特性(Provided Required Feature) と呼ぶ。
特性の方向の表記や意味を、表5.2 に示す。

|表記|意味|説明|
|---|---|---|
|prov|提供|ある特性（操作、シグナル受信、フロープロパティ以外のプロパティ）がブロックによってサポートされており、他のブロックから使用できる|
|reqd|要求|ある特性をブロックで使用するが、それは別のブロックによってサポートされている必要がある|
|provreqd|提供要求|ある特性が、提供と要求の両方に当てはまる場合|

### 共役ポート

コネクタで接続された2 つのポートの型は、入出力の方向が互いに逆向きになることが多い。
このような場合に、入出力の向きが逆向きのフロープロパティを持たせた2つのブロックを用意して対応できるが、共役ポート（Conjugated Port）を用いれば1つのブロックのみを使って表現できる。
共役ポートでは、ブロックに定義されたフロープロパティの入出力が反転する。
すなわち、入力が出力に、出力が入力として解釈される。
同様に共役ポートでは、ブロックに定義された特性の提供と要求の意味が反転する。
そして、提供が要求に、要求が提供として解釈される。

図5.1 の例では、凝縮器から出力される使用済み冷却水は、冷却塔に対する入力となる。
逆に未使用冷却水は凝縮器の入力であり、冷却塔の出力である。
このように入出力が反転した2つのポートを1つのブロック「冷却水仕様」と共役ポートを使って図5.10 のように表現している。
共役ポートは、型名に接頭辞として波線符号（~）を付けて表記する。
共役ポートでのフローの入出力記号は、フロープロパティの指定方向とは反対方向に指定する。

### ネストポート

あるポートを型付けるブロックがさらにそれ自体にポートを保持している場合、ポートの中にポートが存在する入れ子のポートになる。
このようなポートをネストポート（NestedPort）と呼ぶ。

図5.10 の例では、凝縮器と冷却塔の間の2 つの冷却水の流れを1 組の入出力ポート間のフローでまとめて表現しているが、本節ではネストポートを使った異なるモデルを考えることにする。
図5.11 では、図5.10 と同様の状況をネストポートを使ったモデルで表現している。
冷却水の流れを2 組の入力／出力ポート間のフローに分割して表現している。
この場合のブロック「冷却水仕様」は、図5.12 のように定義する。

ネストポートは、システム設計が進むにつれて内部構造やフローを分解して設計を詳細化していく際に役に立つ。

### アイテムフロー

アイテムフロー（Item Flow）は、関連やコネクタを通してブロック間やパート間を実際に流れる物や情報等を表す。
ポートのフロープロパティが、そのポートを持つブロックやパートの入力や出力として「何が流れることが可能か」を表現するのに対し、アイテムフローは、特定の文脈においてブロック間やパート間で「何が実際に流れるか」を表現する。

図5.1 では、タービンが「高圧気体」を入力として受け付けると規定されているのに対し、バイナリーサイクル地熱発電所の中でタービンが利用される際には「ペンタン（気体）」が流れることを図5.13 のように表現している。
ここで「ペンタン（気体）」は型の名称である。もし同じ方向の複数の流れを表現したい場合には、複数の型の名称をカンマ区切りで記載する。
ポートのフロープロパティとアイテムフローを適切に区別することで、ブロックの再利用性を高めることができる。
例えば、図5.1 の文脈では蒸発器からタービンに対してアイテムフロー「ペンタン（気体）」を流しているが、タービンが持つポート自体は「高圧気体」を受け入れる。
すなわち、このタービンを異なるシステムに持っていけば、ペンタンではない別の気体を流し込む形で使えると考えられる。
もちろん実際には、再利用のための様々な条件や制約を規定しておかなければならない。

### 代理ポートと完全ポート

本節では、代理ポートと完全ポートについて解説する。
代理ポートと完全ポートにはそれぞれ独自の特徴と制約があるが、どちらも操作やシグナル受信といった振る舞い特性やパートを除く同じ種類のプロパティといった構造特性を共通にサポートしているため、同等の内容をモデルに表現できる。
したがって、代理ポートと完全ポートの使い分けについては、一般的には開発方法論や設計手法の問題である。
代理ポートは、ポートやそれを保有するブロックの内部構造を規定せずに、インターフェイス指向でポートの入出力仕様のみを先に決めて設計を進めるブラックボックス的な設計手法に適している。
これに対して完全ポートは、内部構造と入出力仕様を共に設計するホワイトボックス的な設計手法に適している。

#### 代理ポート

代理ポート(Proxy Port) は、そのポートを所有するブロックがもつ特性またはそのブロックの内部パートがもつ特性を代理で外部に公開するポートであり、それ自体は独立したシステムの要素にはならない。
図5.1 に示した凝縮器に対する冷却水の入出力のためのポートについて、代理ポートを使って設計を詳細化したものを図5.14 に示す。
この例では、材質がステンレスの冷却水パイプ接続口を用いて冷却水パイプが接続され、その接続口には未使用冷却水と使用済み冷却水が流入・流出することを示している。

図5.14 に示すように、代理ポートの表記ではステレオタイプ名≪ proxy ≫を用いる。
代理ポートがブロックの内部のパートの特性を代理公開している場合には、代理ポートと内部のパートが同じプロパティ値をもつことを示すための拘束コネクタ（「7.5 拘束コネクタ」参照）で結合する。
代理ポートを型付ける型には、通常のブロックではなくインターフェイスブロック（Interface Block）という特殊なブロックを用いなければならない。
図5.15 に示すように、インターフェイスブロックの表記ではステレオタイプ名≪ inter-faceBlock ≫を用いる。
インターフェイスブロックは実際にシステムを構成する要素ではないので、インターフェイスブロックが操作の実装のような振る舞いや、内部パートのような内部構造をもつことはできない。
ステレオタイプのないポートと同様に、代理ポートをネストポートにできる。ただしその場合は入れ子にできるのは代理ポートに限られる。
また代理ポートは共役ポートにできる。

なお、図5.5 に示したポートの区画表記の例と同様に、代理ポートをブロック定義図内のブロックのproxy ports 区画中に記載できる。
この場合、ポート名の左側に記載する入出力方向の記法や意味は、ステレオタイプのないポートの場合と同じである。

#### 完全ポート

完全ポート(Full Port) は、それ自体が独立したシステムの要素として独自の特性をもつポートである。
意味的には、ブロックに属するパートが、そのブロックの境界にポートとして配置されていることとほぼ同じである。
図5.1 に示した凝縮器への冷却水の入出力ポートについて、完全ポートを使って設計を詳細化したものを図5.16 に示す。
この例では、材質がステンレスの冷却水パイプ接続口を用いて冷却水パイプが接続され、その接続口には未使用冷却水と使用済み冷却水が流入・流出することを示している。
ちなみに、図5.14 の代理ポートの例と図5.16 の完全ポートの例は、モデル上の表現は異なるが、最終的に構築されるシステムは同じものになる。

図5.16 に示すように、完全ポートの表記ではステレオタイプ名≪ full ≫を用いる。
完全ポートを型付ける型には、通常のブロックを用いる。
完全ポートはシステムの独立した構成要素となる。
このため、ブロックの内部パートと完全ポートを拘束コネクタで連結できない。
ステレオタイプのないポートと同様に、完全ポートはネストポートにできる。
しかし、完全ポートは共役ポートにはできない。
これは完全ポートがもつ操作の実装などの振る舞いが、フローの入出力の特定の方向や、特性の提供／要求の特定の方向を前提として、通常実装されているためである。
なお、図5.5 に示したポートの区画表記の例と同様に、完全ポートをブロック定義図内のブロックのfull ports 区画中に記載できる。
この場合にポート名の左側に記載する入出力方向の記法や意味は、ステレオタイプのないポートの場合と同じである。

### ポートとインターフェイス

ポートに対して、そのポートを保持するブロックが外部に対して提供または要求する"サービス"を表現できる。
この場合の意味と表記法はUML のポートをそのまま踏襲している。

5.18 に、ポートに対するインターフェイスの表記方法の例を示す。
なお、図5.18 は、図5.8 で提供特性と要求特性の観点でモデリングした電圧管理の例を、"サービス"の観点でモデリングし直したものだ。
提供インターフェイス（Provided Interface）や要求インターフェイス（Required Interface）を記述することによって、ポートに対応するサービスを仕様化できる。
ポートは、提供インターフェイスと要求インターフェイスの両方、またはいずれかを持つことができる。
図5.18 に示すように、提供インターフェイスは「ロリポップ」、要求インターフェイスは「ソケット」の記号で表す。
図5.18 の例では、「: 変圧器」パートは「電圧操作」インターフェイスを外部に対して提供している。
すなわち、「: 変圧器」パートに対して外部から「電圧操作」インターフェイスで定義したサービスを呼び出すことができる。
また、「: 変圧器」パートは「電圧データ」インターフェイスを要求している。
すなわち、「: 変圧器」パートは外部の「電圧データ」インターフェイスを呼び出すことを必要とする。
そして、「: 集中管理室」パートは、その逆のインターフェイスを提供・要求する。
このように、提供側と要求側のインターフェイス型を適合させながら、ポートを持つブロックやパート同士を結びつけることができる。
インターフェイスというモデル要素は、UML からSysML に引き継がれたものである。
SysMLでは、図5.19 の例で示すようにブロック定義図を使ってその詳細を表現する。
図5.19では、集中管理室が変圧器を操作する際、目標電圧を設定することを示している。
また変圧器が集中管理室に対して、実際の出力電圧やタップ（巻線上の接続ポイント）の位置情報を通知することを示している。
インターフェイスが持つサービスの仕様は、操作（Operation）として定義する。
操作区画に記述する操作の書式については、「3.5.7 操作区画」を参照して欲しい。
インターフェイスは、ブロックが提供または要求するサービスの「宣言」を表し、そのサービスの具体的な実現方法については定めない。
インターフェイスに基づいてモデル化を行なうことによって、「宣言」と「実装」を分離でき、部品（コンポーネント）の再利用や差し替えを助ける。
インターフェイスとフロー、提供特性／要求特性の使い分けに迷う場合もあるかもしれない。
インターフェイスはサービス・ベースでシステム全体の構造を検討することに使うことができる。
また電圧管理の例のように、電気的な情報のやり取りはインターフェイスで表現し、他の物理的な流れはフローで表すというように使い分ける方法が考えられる。
あるいは、情報のやり取りも含めて全てフローのみで表現できる。
インターフェイスやフローの代わりに、提供特性や要求特性を用いることもできるだろう。
このように、ポートやフローの表現には様々な方法が考えられる。
状況に応じた使い分け方を工夫して欲しい。

## 要求図

本章では、様々なレベルの要求や要求間の関係を表現するための図である要求図について解説する。

### 要求図とは

要求(Requirement) とは、システムに関わる利害関係者が求める、システムが持つべき能力や満たすべき条件を記述したものである。
要求は、システムの開発者と顧客等の利害関係者との合意事項を記述するために利用できる。
要求には機能要求の他、処理性能に代表されるような非機能要求が含まれる。
要求図(Requirement Diagram) は、特に要求開発などの場面において、主として要求や要求間の関係を表現するために利用できる。
従来UML を使って要求開発を行なう場合、ユースケース図を用いてきた。
しかしユースケース図は機能要求を扱うための図であり、非機能的な要求を扱うことはできない。
要求図では機能要求だけでなく、非機能要求も含めた要求全体を包括的に扱うことができる。
要求には、利害関係者の求めるところをやや抽象的に表現するものもあれば、より具体的で詳細なものもある。
全ての要求は、利害関係者がシステムに求める要求から派生したものと考えられる。
例えば、ある目覚まし時計に搭載するブザーについて考えてみよう。
この目覚まし時計は、一定の音量を最大出力とするブザーを搭載することを定めた要求に従って作られている。
この要求は、「目覚まし音を鳴らす」という機能要求を実現するために派生してできた要求と考えられる。
そして「目覚まし音を鳴らす」という機能要求は、利用者の「設定した時刻に目覚める」という要求から派生したものと考えられる。
このように、システムの具体的な要求から利害関係者の要求までの関係を理解することで、各要求の必要性を確認できる。
このような関係を確認することは、特にシステムを変更する必要が生じた際に重要となる。
要求の必要性が不明確な状況では、どの要求をどのように変更すべきかを判断することは困難である。
一方、システムの変更ではなくシステムを一から検討するような場合には、利害関係者の要求からシステムの具体的な要求までをトップダウン的に詳細化しながら検討していくことになる。

### 要求図の例

ここでは、津波早期検知システムを題材として解説する。

津波早期検知システムは、津波の発生を早期に検知するためのシステムである。
津波発生時に臨海地域の住民に対し、できるだけ早期に避難指示・避難勧告を伝えることを目標としている。
津波早期検知システムでは、海底に設置した観測ノードで水圧を測定し、観測データを陸上局に伝達する。
津波発生時には、水圧の変化によって陸上局が津波の発生を判断する。
このように陸上からだけでなく海中で情報を収集することで、結果として早期に避難指示・避難勧告を発令することが可能となる。

図6.1 に示すように、各観測ノードはケーブルでつながれ、2 つの陸上局が対となってケーブルの両端に位置する構成となっている。
沖合から沿岸寄りまで観測ノードを配置することで、津波の接近する様子を観測することが可能となる。

図6.2 では、津波早期検知システムに関する要求のうち、利害関係者が直接求めているレベルの要求（利害関係者要求）を示す。
ここでは利害関係者のうち、「臨海地住民」「津波情報観測者」「津波予測技術研究者」に着目している。
ここで「津波情報観測者」は津波早期検知システムから直接観測データを受け取り、処理する立場の関係者を表す。
「津波予測技術研究者」は、より長期的な視点で津波予測技術の向上を図っていく立場を表している。
「津波情報観測者」の要求も「津波予測技術研究者」の要求も、「臨海地住民」の要求に帰着している。

6.3 では、津波早期検知システムに関する要求のうち、システムのあり方に直結するレベルの要求（システム要求）を示す。
ただし利害関係者要求も一部記載して、システム要求の各要求がどの利害関係者要求（灰色で表記）と関係しているかも示している。
これら要求群は階層構造を成しており、上位が利害関係者要求、下位がシステム要求となっている。
またシステム要求の中にも、「信頼性」「可用性」といった品質特性のレベルと、より具体的なレベルのものがある。
図6.2 も図6.3、図6.4 も、共に非機能要求のみを記載しており、機能要求は記載していない。
図6.2 や図6.3、図6.4 から、以下を含む多くの事柄を読み取ることができる。

- 各観測点をケーブルでつなぐ方式を採用していることで、観測点を柔軟に展開することが容易となり、観測範囲の網羅性を高めやすい。
- またケーブル方式のため、他の無線を使う方式と比べて高い通信品質を確保しやすい。
- システムの可用性を高めるために、ケーブルの両端に地上局を配置して2 箇所から給電し、ケーブルの双方向に観測データを伝送する方式をとっている。
- 海底地滑りや乱泥流の影響を避けてシステムの信頼性を高めるため、ケーブルルートの選定に配慮が必要である。

### 要求図のモデル要素
#### 要求

図6.3 では、システムが持つべき能力として、「観測した水圧データに対して温度補正を行なう」ということが規定されていることを図6.5 のように表現している。
このように、システムが持つべき能力や満たすべき条件の規定を、要求(Requirement) と呼ぶ。
要求を用いることで、テキストで記述された様々な要求事項について相互に関係を表現することや、要求以外の種々のモデル要素との関係を表現できる。
要求はステレオタイプ名《requirement》を用いて表記する。

要求は以下のプロパティを持つ。

|プロパティ名称|説明|
|---|---|
|id|要求を一意に識別するID|
|text|要求を表現する文章表現、または文章表現への参照|

idやtextも文字列型であり、自由な文字列を設定できる。また上記以外のプロパティ（例
えば、検証ステータス等）を利用者が追加できる。

#### 要求と各種モデル要素との関係の表現

本項では、要求と要求、または要求と他の種類のモデル要素の間の関係を表現するためのモ
デル要素について解説する。

##### 派生要求関係

図6.3 では、要求「温度計」が要求「温度補正」から派生して生じた要求であることを図6.6 のように表現している。
このように、一方の要求が他方の要求から派生して生じた要求であるとき、双方の間の依存関係を派生要求(Derive Requirement) 関係で表現できる。

派生要求関係は破線矢印にステレオタイプ名《deriveReqt》を付加して表記する。
矢印の向きは、派生して生じる要求から派生元の要求に向けたものになる。

同様の関係を、コールアウト形式と呼ばれる方法で表記できる。
図6.7 では、図6.6 と同等の内容をコールアウト形式で表現している。
コールアウト形式では、図6.7 のように要素の型を≪要素の型≫のように記載できるが、簡潔さを優先して省略できる。
「6.2 要求図の例」の例のように派生要求関係は、より上位の目的レベルから下位の手段レベルまでの要求の関係を明らかにするために利用できる。
目的-手段の関係の階層構造を表現する上で主要な役割を果たす関係である。

##### 充足関係
充足(Satisfy) 関係は、要求とその要求を満たすモデル要素との依存関係を表現する。
図6.8 は、ブロック「水圧検出素子」によって要求「水圧検出素子」が満たされる関係を表現している。

充足関係は破線矢印にステレオタイプ名《satisfy》を付加して表記する。
矢印の向きは、要求を満たすモデル要素から満たされる要求に向けたものになる。

充足関係をコールアウト形式で表記できる。
図6.9 では、図6.8 と同等の内容をコールアウト形式で表現している。

充足関係を活用することで、要求とそれを実現する構造や振る舞い等のモデル要素との間の追跡性を明確にできる。

##### 検証関係

検証(Verify) 関係は、要求とその要求をシステムが満たしていることを検証するモデル要素との依存関係を表現する。
図6.10 は、テストケース「応答速度計測試験」によって要求「応答性能」が検証される関係を表現している。
検証関係は破線矢印にステレオタイプ名《verify》を付加して表記する。
矢印の向きは、要求を検証するモデル要素から、検証される要求に向けたものになる。

検証関係をコールアウト形式で表記できる。
図6.11 では、図6.10 と同等の内容をコールアウト形式で表現している。
検証関係のコールアウト形式表現は、図6.3 の中でも使用している。

検証関係を活用することで、要求と、それを検証するテストケース等のモデル要素との間の関係を明確にでき、要求の検証漏れといった問題の回避に役立てることができる。

##### 洗練関係

洗練(Refine) 関係は、要求とその要求を洗練して得られるモデル要素（またはモデル要素群）との依存関係を表現する。
図6.12 は、ユースケース「観測情報の通知」によって要求「観測情報の通知」が洗練される関係があることを表現している。
このように、洗練関係は、要求をユースケースやアクティビティ図等を使って洗練する場合に使うことができる。

図6.12 に登場している要求「観測情報の通知」は、図6.2 や図6.3、図6.4 の例には登場していない。
これは、これらの例が非機能要求のみを記載した図であるためである。要求「観測情報の通知」は機能要求に分類される。

洗練関係は破線矢印にステレオタイプ名《refine》を付加して表記する。
矢印の向きは、要求を洗練した結果得られるモデル要素から、洗練される要求に向けたものになる。

洗練関係をコールアウト形式で表記できる。
図6.13 では、図6.12 と同等の内容をコールアウト形式で表現している。

洗練関係を活用することで、より上流の工程の成果物とより下流の成果物の関係を明確化でき、成果物の追跡性を向上させることができる。

##### 複製関係

図6.14 では、気象庁の要求「警報の発表」が要求「気象業務法13 条1 項」の複製であることを表現している。
このように、一方の要求を他方の要求の複製として定義するとき、双方の間の依存関係を複製(Copy) 関係で表現できる。

複製関係が必要とされる背景には、要求が名前空間の階層構造の中に位置付けられることがある。
あるモデル要素は単一の名前空間にしか存在できず、異なる名前空間の階層に登場できないため、要求の再利用を進めるために複製関係が導入された。
複製関係を活用することで、新規に体系だった要求群を作成する際に、既存の要求群を再利用しながら進めることが容易になる。

複製関係にある2つの要求は、マスター(Master) 要求とスレーブ(Slave) 要求として位置づけられる。
スレーブ要求のtext プロパティの値は、マスター要求のtext プロパティの値と等しくなり、スレーブ要求のtext プロパティを独自に変更できない。
複製関係は破線矢印にステレオタイプ名《copy》を付加して表記する。
矢印の向きは、スレーブ要求からマスター要求に向けたものになる。

複製関係をコールアウト形式で表記できる。
図6.15 では、図6.14 の複製関係と同等の内容をコールアウト形式で表現している。

##### 追跡関係

追跡(Trace) 関係は、要求と他のモデル要素との間の一般的な関係を表現する。
追跡関係は特定の強い意味合いを持たないため、本項で紹介した他の種類の関係と組み合わせて使用することは推奨しない。

追跡関係は破線矢印にステレオタイプ名《trace》を付加して表記する。
矢印の向きは、要求から要求が関係する要素に向けたものになる。
本章で示した津波早期検知システムの題材の中では、追跡関係は使用していない。

追跡関係をコールアウト形式で表記できる。
図6.17 では、図6.16 と同等の内容をコールアウト形式で表現している。

##### 包含関係

図6.2 では、要求「津波情報観測者要求」が、「観測点の網羅性」、「観測情報の精度」といった複数の要求から構成されていることを、図6.18 のように表現している。
このように、親の要求を元に、複数の子の要求に分解する時、親と子の要求の関係を包含(Containment) 関係で表現する。

包含関係を使って親の要求を複数の子の要求に分解する場合、親の要求は子の要求群の論理積の意味になる。
すなわち、親の要求が満たされるためには、全ての子の要求が満たされなければならない。
ただしこれは包含関係のデフォルトの解釈であり、親の要求に明記することによって異なる意味を持たせることもできる。

包含関係は名前空間における親子関係である。
すなわち、要求は包含関係における直接の親を1つしか持つことができない。

要求に対して派生関係の分析をしたり、様々な追跡性を適切に管理したりするには、要求をあらかじめ適度な粒度に分解しておくことが望ましい。
そうした分解のための手段として、要求間の包含関係を有効に活用できる。

#### 要求の分類

本項では、SysML 仕様書で紹介されている、標準規定外の要求の拡張について解説する。

図6.3 では要求「応答性能」がシステムの性能についての定量的な規定であることを図6.19のように表現している。
ここではステレオタイプ≪ requirement ≫を用いた通常の要求ではなく、ステレオタイプ≪ performanceRequirement ≫を使って拡張した要求を用いている。
このように、通常の要求を適切に拡張することによって、要求の分類を明確にしながら、使いたいプロパティを要求に追加できる。

|ステレオタイプ名|説明|充足可能な要素|
|---|---|---|
|«functionalRequirement»|システムやパートの機能|操作、振る舞い|
|«interfaceRequirement»|システムやパート間のインターフェイスの仕様|ポート、コネクタ、アイテムフロー、制約プロパティ|
|«performanceRequirement»|システムやパートの能力や必要条件ついての定量的な規定値プロパティ||
|«physicalRequirement»|システムやパートの物理的性質や物理的制約の規定|構造的要素|
|«designConstraint»|システムやパートの実装上の制約|ブロック、パート|
|«extendedRequirement»|上記５種類の要求の共通項的な要求。
表6.3 のプロパティが使用可能|特に制限なし|

表6.2 では、要求の規定外拡張のステレオタイプやその説明、拡張された要求を充足させることができるモデル要素の種類を記載している。

|プロパティ名称|型|説明|
|---|---|---|
|source|String|要求の出所|
|risk|RiskKind|リスクレベル|
|verifyMethod|VerifyMethodKind|検証方法|

表6.3 では、表6.2 で示している各種拡張要求が各々保持するプロパティを示している。

|列挙型名称|列挙子|説明|
|---|---|---|
|RiskKind|High|受け入れ不能レベル|
|RiskKind|Medium|受け入れ可能レベル|
|RiskKind|Low|リスク無し、またはごくわずかなリスク|
|VerificationMethodKind|Analysis|分析による検証|
|VerificationMethodKind|Demonstration|デモによる検証|
|VerificationMethodKind|Inspection|インスペクションによる検証|
|VerificationMethodKind|Test|テストによる検証|

表6.4 は、表6.3 で示されるプロパティのための列挙型を示している。

#### 要求図で用いられるその他の要素

##### テストケース

図6.10 に登場しているテストケース(Test Case) は、要求が満たされていることを検証するための方法を表現するモデル要素である。

6.20 では、テストケース「応答速度計測試験」をシーケンス図の形で表現している。
テストケースはシーケンス図の他、ステートマシン図やアクティビティ図で表現できる。
テストケースは検証の結果を判定種別(VerdictKind) 型の戻り値として返す。
判定種別は評価結果を表す列挙子型であり、以下の値をとる。

|名称|意味|
|---|---|
|pass|テスト対象のシステムは期待通りに動作する|
|fail|テスト対象のシステムは期待と異なる動作をする|
|inconclusive|pass やfail といった評価ができない|
|error|テスト環境の中でエラーが発生した|

SysMLのテストケースについての仕様は、SysML とは別の標準仕様であるUML TestingProfile と整合するように定義されている。
このため2 つの仕様を組み合わせ、SysML のテストケースをUML Testing Profile に則って定義可能である。
UML Testing Profileについては「6.4.4 要求の妥当性確認」で紹介している。

##### 根拠

図6.3 では、要求「ケーブル方式」が要求「安定した通信品質」から派生する際に、有線の通信の方が無線よりも信頼性が高いことを派生の根拠とすることを、図6.21 のように表現している。
このように、要求や設計等の判断の正当性を表現するためのモデル要素を、根拠(Rationale) と呼ぶ。

根拠はコメント（「2.3 コメント」を参照）を拡張したモデル要素であり、ステレオタイプ名《rationale》を使って表記する。
根拠は関係も含め、あらゆるモデル要素に付加できる。
特に要求図では、図6.21 のように派生要求関係を補足するための用途に根拠を使用できる。
また、充足関係で要求とブロックの関係を表現する際の設計判断上の根拠として、他の文献を参照するといった使い方がある。

##### 問題

6.3 では、要求「ケーブルルートの選定」と要求「信頼性」の間の派生要求関係に対して、海底地滑りや乱泥流による影響の問題が関係していることを、図6.22 のように表現している。
このように、1つ以上のモデル要素に関係する欠陥や制限、失敗等の望ましくない事柄を表現するためのモデル要素を、問題(Problem) と呼ぶ。
問題はコメントを拡張したモデル要素であり、ステレオタイプ名《problem》を使って表記する。
問題はあらゆるモデル要素に付加できる。

#### 表形式表現

要求図の内容を表形式で表現できる。
図6.23 は、図6.4 の要求図の一部を表形式で示したものである。
このように、表形式表現では、要求のプロパティを記載できる。
この他、要求との関係や、関係の根拠、要求を充足するモデル要素等を記載しても良い。
図6.24 には、要求間の派生要求関係を表形式表現で記述した例を示す。

### 要求図の応用

本節では、要求図を用いてシステム開発を進める場合の要求図の利用方法の例や、関連する情報について解説する。
システム開発における要求に関する活動を以下のように分類し、各々について述べていく。

#### 要求抽出

要求抽出の段階では、要求図上に多くの要求を記載していく作業を行なう。
この段階では要求間の関係は記載せず、要求のみを網羅的に記載する。要求抽出の作業では、利害関係者に対するインタビューやアンケート等、様々な方法を駆使して要求を抽出し、網羅性を高める努力を行なう。
要求のうち機能要求については、ユースケースを踏まえて抽出することが考えられる。
SysML には機能要求の表現手段としてユースケースがある。
ユースケースと要求図の要求との関係を整理して扱う必要がある。
表現するユースケースの抽象度や付加的な情報の量にもよるが、ユースケースのみではシステムの開発に必要な情報が網羅されない場合がある。
要求図に要求を追加することで情報の網羅性を高める方法が考えられる。
要求のうち非機能要求を抽出する際には、品質特性を意識することが有効である。
品質特性には、ソフトウェア向けのJIS X 0129-1 で定義されたものなど多くのものが提案されているので、参考にされたい。
利害関係者にとって関心のある品質特性、例えば効率性、信頼性、保守性、再利用性等について、各利害関係者の要求を抽出していく。

#### 要求分析

要求図を用いた要求の分析方法の1つとして、要求間の派生要求関係の構造を分析して明らかにする方法が挙げられる。
要求間の派生要求関係で複数レベルの要求の関係を示すことで、各要求の必要性が明示でき、また要求の変更が発生した場合の影響をたどることも可能になる。
このアプローチは図6.2 や図6.3、図6.4 にも見ることができる。
ある要求の目的レベルに相当する上位の要求を確認することにより、要求の必要性を確認できる。
一方、ある要求の手段レベルに相当する下位の要求を確認することによって、要求の具体的な実現の方向性が確認できる。
こうした確認を各要求に対して徹底して行なうことにより、各要求の妥当性や網羅性を確かなものにできる。

本章の題材では、利害関係者要求とシステム要求の階層を示している。
要求の階層はより詳細な多くの階層に分割することも考えられる。
例えば、多くのシステムを組み合わせた複合的なシステムの要求と、その構成要素となるシステムの要求とを別の階層として定義する等が考えられる。
分析対象のシステムの性格を考慮して階層構造の定義を検討されたい。
こうした派生要求関係を用いた分析を実施する上で、ゴール指向分析[7]が参考になるだろう。
必要に応じて参照されたい。

#### 要求の仕様化

要求は要求図の他に表形式で表現できることは「6.3.5 表形式表現」で述べた。
要求をドキュメント化する方法として、要求図、表の他に要求管理ツールを使用する方法がある。
要求管理ツールを使用すると、要求と他の情報とのトレーサビリティ管理や要求の構成管理が行いやすいといった特徴がある。
要求管理ツールによっては、SysML 対応のモデリングツールと高度に連携し、要求の情報を同期できるものもある。
またSysML 対応のモデリングツールの機能により、要求図から表を生成することや、要求図と表の同期をとることを可能にするツールもある。
これらの点を踏まえ、要求図と表、要求管理ツールの使い分けを検討されたい。
表6.7 は、要求図と表、要求管理ツールを比較したものである。

||長所|短所|
|---:|---|---|
|要求図|要求間の関係を直感的に理解しやすい記述の自由度が高い|要求に変更があった場合の保守が比較的大変。要求の数が多いと一覧性が良くない|
|表|多くの要求を記載する場合に一覧性が高い。手軽に使い始められる|要求間の関係が分かりにくい|
|要求管理ツール|要求を継続的に管理するための各種機能が充実している|導入は手軽ではない|

#### 要求の妥当性確認

設計等、要求の実現方法を検討する前の段階で、要求の妥当性を確認することにより、不要な要求や適切でない要求を修正できる場合がある。
妥当性確認の方法として、ピアレビューやユーザ受け入れテスト作成等がある。
「6.3.4 要求図で用いられるその他の要素」ではテストケースをモデル化することで、要求の妥当性確認を行なう1つの方法を示した。
このようなテストケースのモデル化は、特に要求の試験性が気になる場合の妥当性確認方法として有効と思われる。
ここではUML Testing Profile を用いてテストケースを記述する方法を紹介する。
UML Testing Profile はテスト仕様をモデル化するためのUML の拡張仕様である。
UML Testing Profile では、テストコンテキスト(Test Context)、テストコンポーネント(TestComponent)、テストケース(Test Case)、SUT(System Under Test) といったテスト固有の概念を定義しており、これらを用いてテスト環境下における各要素の役割を明確化できる。
またUML Testing Profile はJUnit やTTCN-3 といったソフトウェアテスト自動化フレームワークとの連携が意図されている。

図6.27 に示す要素はテストコンテキストと呼ばれ、複数のテストケースを結びつける役割を持つ。

図6.28 は図6.20 と同様、テストケース「応答速度計測試験」をシーケンス図の形で表現したものである。
ただし図6.28 の場合、UML Testing Profile で定義されたモデル要素であるタイマーを用いている。

#### 要求管理

要求管理においては、要求と要求、または要求と他の情報との追跡性を確保することが重要である。
追跡性を維持することにより、要求の変更時に適切な対応が可能となる。
要求図では、前述のような各種関係を用い、要求と要求間、要求と他のモデル要素間の追跡性を記述できる。
要求を表で管理する場合には、要求と対応箇所の関係をマトリクス形式で記述した要求トレーサビリティ・マトリクスを作成することで追跡性を確保できる。
要求トレーサビリティ・マトリクスについては、文献[8]を参照されたい。
要求管理ツールでは、追跡性のための高度な機能が提供されている。

## パラメトリック図

本章では、システムの特性間に成立する各種制約を表現するための図であるパラメトリック図について解説する。

### パラメトリック図とは

システムを開発する上で、システムに対する要求を確実に満たすことのできる設計を行なうことは非常に重要である。
システムの処理パフォーマンスや信頼性等についての重要な要求が、システム設計上の判断やその結果導かれるシステムの特性とどのように関係しているかについて早期に明らかにすることによって、結果として要求に沿ったシステムを手戻り無く開発することが可能になる。

第3 章「ブロック定義図」や第4 章「内部ブロック図」において、SysML ではシステムについての数値的な情報を表現するために値プロパティを利用できることを示した。
このような数値的な情報群に対し、それらの関係性を数式等で記述した制約として定義し、これら制約群を組み合わせることを考えてみて欲しい。
このようにすることで、様々な観点からシミュレーションをし、システムのあり方について明らかにできる。
ひいてはシステムに対する効果指標に沿った評価が可能となる。
パラメトリック図(Parametric Diagram) を用いることで、システムの様々な特性に対して、特性間の制約を明確にできる。
システムの特性が本来求められるところと合致するかどうか、早い段階で確認しながら開発を進めることができる。
このため手戻りが減り、開発コストを抑制できる。
例えば、懐中電灯に搭載する電池の種類や個数を決定することを考えてみよう。
電池の種類や個数は、懐中電灯の重量や運用コスト、明るさ、連続点灯時間等、多くの事柄に影響する。
これらの事柄をどのように評価するか、電池の種類や個数とどのように関係するかを早期に明確化することで、実際に試作や評価試験を行なうことなく、電池の種類や個数を決定することも可能となる。
このように、システムの様々な特性間の制約を明確にすることで、システム設計における設計判断の結果を明確にでき、システムの開発を効率的に進めることができる。

### パラメトリック図の例

ここでは、ダブル発電システムを題材として解説する。
ダブル発電システムは、太陽光発電とエネファームという2つの発電用サブシステムを組み合わせた、家庭用の発電システムである。
ここでエネファームは、燃料電池を使ってガスから電力を取り出す発電装置の愛称である。
エネファームでは発電時の排熱を給湯や暖房に利用する。
太陽光発電とエネファームによる発電には、以下のような制約があり、発電の制御の仕方に影響している。

- 太陽光発電で得られた電力を売電、すなわち電力会社に売ることが可能である。
- エネファームから得られた電力は、法的な制約により売電できないため、必要以上の電力をエネファームで発電することはしない。
- エネファームは、発電の排熱で湯を沸かすことでトータル的な環境性能を発揮するため、湯の需要が満たされた状況では発電しない。

図7.1 では、ダブル発電システムにおける使用電力量、発電量、売電量、買電量に関係する制約群を示している。
これら4つの値の間の関係を表しているのが「電力関係」制約であり、その他の3つの制約は、各々発電量、売電量、買電量に関する制約である。
またこれらの制約群と、ダブル発電システムの特性との関係も表現している。
パラメトリック図は特殊な内部ブロック図である。
パラメトリック図で表現する情報は、図7.1 に示すように制約と制約を受ける各種プロパティ、およびそれらの関係に制限されている。

図7.2 は、図7.1 の中に記載されている制約「発電量関係」の内部の構造をより詳細に示したものである。
このように複雑な制約を、より単純な複数の制約の組み合わせとして表現できる。

図7.3 は、図7.1、図7.2 で使われている各制約の定義を示したブロック定義図である。
制約の定義に加えて制約間の階層構造を表現している。

図7.4 は、環境性や経済性の観点から、ダブル発電方式を含めた各種エネルギー利用方式を評価するための方法を示した図である。
CO2 排出量等のいくつかの値をもとにして環境性スコアと経済性スコアを算出し、更にこれらのスコアをもとにシステムの総合的な有効性を表すスコアを算出している。

### 制約ブロック

図7.3 では、数式で表された制約や、制約のためのパラメータを図7.5 のように定義している。
このように、制約や制約のためのパラメータを定義するためのブロックを制約ブロック(Constraint Block) と呼ぶ。
図7.5 は電力関係の制約として「使用電力量＋売電量=発電量＋買電量」、パラメータとして「使用電力量」、「売電量」等を定義している。
第3 章「ブロック定義図」で説明したように、ブロック定義図では型を定義できる。
制約ブロックはブロックの一種であり、ブロック定義図で定義する。
通常のブロックの場合、そのインスタンス（役割を表す要素）は内部ブロック図の中でプロパティとして登場するが、制約ブロックのインスタンスは、パラメトリック図の中で後述の制約プロパティとして登場する。
制約ブロックで汎用的な制約を定義しておくことで、制約ブロックを複数のパラメトリック図で再利用可能である。

制約ブロックはステレオタイプ名≪ constraints ≫を使って表記する。
制約ブロックの制約区画には制約を記載する。
制約区画については「3.5.4 制約区画」を参照されたい。
制約ブロックのパラメータ区画には制約のためのパラメータを記載する。
パラメータ区画には区画内の上部に区画名「parameters」を表記する。

### 制約プロパティ

図7.1 では、複数の制約を組み合わせてダブル発電に関する制約関係を表現する上で、図7.5 で示した制約ブロック「電力関係」のインスタンスを図7.6 のように表現している。
このように、パラメトリック図の中に登場する制約ブロックのインスタンスを制約プロパティ(Constraint Property) と呼ぶ。
制約プロパティは角の丸い矩形として表記する。制約プロパティのパラメータは、制約プロパティの矩形の内側に接する正方形で表現する。

図7.6 は、図7.7 のように表記してもよい。

### 拘束コネクタ

図7.2 では、制約プロパティ「double : ダブル発電関係」のパラメータ「太陽光発電量」と、制約プロパティ「sp : 太陽光発電量制約」のパラメータ「太陽光発電量」の値が等しいことを、図7.8 のように表現している。
このように、両端の値が等しいことを表現するコネクタを拘束コネクタ(Binding Connector) と呼ぶ。
拘束コネクタの両端は同じ型もしくは等価として扱える型でなければならない。

図7.2 では、拘束コネクタを使った制約プロパティのパラメータと別の制約プロパティのパラメータとの関係だけでなく、値プロパティとの関係も図7.9 の様に示している。
このように拘束コネクタを使って制約プロパティ以外の要素との関係も表現できる。

### 目的関数と効果指標

図7.10 は図7.4 の一部を抜粋したもので、「エネルギー利用方式の目的関数」と、関連する情報を示している。
「エネルギー利用方式の目的関数」は「有効性スコア」を求めるための関数であり、「環境性スコア」と「経済性スコア」をパラメータとして使用する。
システムエンジニアリングにおいて、システムの実現方法をいくつかの代替案の中から選択するトレードオフ分析は重要な手法の1つである。
SysML では、制約ブロックを使ったトレードオフ分析のための非標準拡張が定義されており、これにはステレオタイプ≪ moe ≫と≪ objectiveFunction ≫が含まれる。
ステレオタイプ≪ moe ≫はプロパティを拡張したモデル要素である。
≪ moe ≫はmea-sure of effectiveness の略で、効果指標を表す。
効果指標は、トレードオフの検討をする際に重要な指標となるパラメータであることを意味する。

また、それらの効果指標を用いて、システムの代替案の包括的な価値を算出するための評価法を表す関数を目的関数(Objective Function) と呼ぶ。
目的関数は制約プロパティまたは制約ブロックを拡張したモデル要素であり、ステレオタイプ名≪ objectiveFunction ≫を表記して表す。

## アクティビティ図

本章では、処理の順序やデータの流れを表すアクティビティ図について解説する。

### アクティビティ図とは

アクティビティ図(Activity Diagram) は、処理や作業の順序、データの流れを表すのに適した図である。
アクティビティ図は、フローチャートのように処理や作業の流れを表現でき、同時にデータフローダイアグラム(DFD) のように処理の間のデータの流れを表現できる。
アクティビティ図を使って様々な粒度の処理の流れを書くことができ、粒度ごとに階層化できる。
例えばアクティビティ図を使って概略レベルの処理を記述した上で、そこから呼び出される詳細レベルの処理を下位階層の処理として記述する、といったことができる。
ソフトウェアのソースコードレベルの詳細な処理の記述や、抽象度の高い大まかな処理の記述にアクティビティ図を利用できる。
SysML のアクティビティ図では、UML のアクティビティ図で利用可能なモデル要素に加えて、幾つかの追加の要素を利用可能である。
本章ではUML のアクティビティ図で利用可能な主なモデル要素について解説し、続いてSysML 固有の要素について解説する。

### アクティビティ図の例

ここでは、GPS 内蔵の背面ディスプレイ付きデジタルスチールカメラを題材として解説する。
システム（題材のカメラ）は、背面ディスプレイに画像を常時表示し、シャッターボタン押下時に写真を保存する機能を持つ。
連続撮影は既定枚数分可能で、その為のバッファを内部に保持している。
撮影時に位置情報を写真のデータに付加する機能がある。

図8.1 では、システムの電源をON にした後の動作の概要を示す。
システムは動作開始後、背面ディスプレイの初期化と素子の初期化を行なう。
ディスプレイの初期化が終わると、企業ロゴをディスプレイに表示し、素子の初期化完了を待つ。
その後、イメージを生成するための動作に移行する。

図8.2 では図8.1 に登場している処理「イメージ生成」の内容の詳細を示している。
図8.2で示すように、システムは背面ディスプレイに表示する画像と、写真として保存する静止画の2 種類の画像を生成する。
いずれの画像も、受光した撮像素子が保持する素子データを元に生成される。
システムは写真にGPS 情報を埋め込むため、位置情報の作成も行なう。

図8.3 では図8.2 に登場している処理「保存用静止画作成」の内容の詳細を示している。
図8.3 に見られるように、素子データから保存用画像(写真) を作成するときには、システムは背面ディスプレイを更新しないようにしている。
保存用画像は素子データを元に生成される。
位置情報が取得できれば保存用画像に位置情報を付加する。
保存用画像を作成し終わると、システムは背面ディスプレイの更新を再開する。

### UML と共通のモデル要素

SysML のアクティビティ図では、UML のアクティビティ図と共通のモデル要素に加え、SysML に固有のモデル要素を利用できる。
本節では、UML と共通のモデル要素について解説する。

#### アクティビティ

##### アクティビティ

図8.1、図8.2、図8.3 の各図の図全体で示されるように、アクションやオブジェクトノードの一連の流れをまとめたものをアクティビティ(Activity) と呼ぶ。

##### アクション

8.2 では、システムが「ディスプレイ画像作成」の処理を実行することを図8.4 のように表現している。
このように、システムが行なう処理や作業を表すモデル要素を、アクション(Action) と呼ぶ。
アクションは角の丸い矩形として表記する。
矩形の中にアクション名を表記する。

アクションは例外的な場合を除き、以下のような順序で動作する。

1. 入力を定義する全てのフロー（アクションに向かう矢印）に入力が揃った時、アクションが開始される。
2. アクションの処理が実行される。
3. アクションの処理が終了した時、出力を定義する全てのフロー（アクションから外に向かう矢印）から同時に出力される。

例外として、「8.3.5 ストリーム」で後述するストリームを使用する場合には上記の順序は適用されない。

##### 制御フロー

図8.1 では、システムの実行順序として、「ディスプレイ初期化」を実行してから「企業ロゴ表示」を実行することを図8.5 のように表現している。
このように、アクションの実行順序を表すモデル要素を制御フロー(Control Flow) と呼ぶ。
制御フローは、図8.5 の上側の図のように実線の矢印で表記するが、下側の図のように破線矢印で表記できる。
特に後述のオブジェクトフローと区別して表記したい場合には、破線矢印の表記が有用である。
本章の題材では制御フローを破線矢印で表記している。

##### 開始ノード

図8.3 では、アクティビティ（この場合、図8.3 全体の処理）が開始されたときに、まず「作成停止」アクションが最初に実行されることを、図8.6 のように表現している。
このように、アクティビティの開始を表現する要素が開始ノード(Initial Node) である。

##### アクティビティ終了ノード

8.1 では、「イメージ生成」終了時にアクティビティが終了することを、図8.7 のように表している。
このように、アクティビティを終了することを表すノードをアクティビティ終了ノード(Activity Final Node) と呼ぶ。

##### フロー終了ノード

図8.2 では、「バッファフル」の処理の終了後、フローが終了することを図8.8 のように表している。
ここで図8.2 の「ディスプレイ更新」のアクションを別のフローとして並行して実行している場合、その「ディスプレイ更新」処理は終了しない。
このように、フローがそのノードで終了することを表すモデル要素がフロー終了ノード(Flow Final Node) である。
前述のアクティビティ終了ノードがアクティビティに含まれる全ての処理を終了することを表すノードだったのに対して、フロー終了ノードはそのフローのみがそのノードで終了することを表す。

##### 振る舞い呼び出しアクション

図8.1 のアクティビティ「動作概要」の中では、アクション「イメージ生成」を実行することで、図8.2 のアクティビティ「イメージ生成」を呼び出している。
またアクティビティ「イメージ生成」の中でもアクション「保存用静止画作成」を実行することで、図8.3 のアクティビティ「保存用静止画作成」を呼び出している。
このように、振る舞い（アクティビティ、相互作用、ステートマシン等）を呼び出すアクションを、振る舞い呼び出しアクション(CallBehavior Action) と呼ぶ。

振る舞い呼び出しアクションは、図8.9 のように熊手の記号をアクションの矩形の中の右下に表記して表現する。
図8.9 では2通りの表記方法を示している。
図8.9 の上図の記法では、呼び出すアクティビティ名に相当する「振る舞い名」のみを記述している。
一方図8.9 の下図の記法では「アクション名:振る舞い名」の形式で記述している。
1つのアクティビティの中の複数箇所で同一の振る舞いを呼び出す場合、図8.9 の下図の記法を用いることで、そのアクションを一意に特定できる。

#### オブジェクトフロー

##### オブジェクトノード

アクティビティ上に登場する角がある矩形はオブジェクトノード(Object Node) である。
オブジェクトノードはアクティビティ上で取り扱うオブジェクトを表している。
オブジェクトノードの表記では、オブジェクト名と型名のどちらか、もしくは両方を表記する。
図8.10 では上から順に、型名のみ記述、型名とオブジェクトノード名両方を記述、オブジェクトノード名のみ記述、という3通りの表記方法を示している。
*1オブジェクトノードはいくつかの種類のモデル要素の総称である。
各種オブジェクトノード間の関係を図8.11 に示す。

##### オブジェクトフロー

図8.2 では、「ディスプレイ画像作成」が実行された結果「ディスプレイ用画像」オブジェクトが出力され、それを入力として「ディスプレイ更新」が実行されることを図8.12 のように表現している。
このように、オブジェクトの入出力を表現するモデル要素がオブジェクトフロー(Object Flow) である。
オブジェクトフローは実線の矢印で表記する。
図8.12 の場合「ディスプレイ画像作成」アクションから「ディスプレイ用画像」オブジェクトへの矢印と、「ディスプレイ用画像」オブジェクトから「ディスプレイ更新」アクションへの矢印がオブジェクトフローを表す。

##### アクティビティパラメータノード

8.13 は、図8.3 のアクティビティの内容を省略して、外枠のみ表記したものである。
図8.3 では、アクティビティの入力として「素子データ」と「位置情報」を受け付け、「制御出力」と「保存用画像」がアクティビティから出力されることを、図8.13 のように表現している。
このように、アクティビティの入出力を表すオブジェクトノードを、アクティビティパラメータノード(Activity Parameter Node) と呼ぶ。
アクティビティパラメータノードは、アクティビティの外枠上に配置された矩形として表記する。

##### ピン

図8.3 では、「素子データ処理」アクションから「画像データ」が出力され、それが「保存用画像作成」アクションに入力されることを、図8.14 のように表現している。
このように、アクションの入出力を表すオブジェクトノードをピン(Pin) と呼ぶ。
このとき、アクションへの入力を表すピンが入力ピン(Input Pin)、出力を表すピンが出力ピン(Output Pin) である。

図8.14と同等の意味を、図8.15 の記法で表現できる。
「8.1 アクティビティ図とは」で解説した通り、アクションの実行と入出力には決まった順序がある。
すなわち、アクションに対して複数の入力ピンが存在した場合、そのアクションは全てのピンと全ての制御フローからの入力があったときに、アクションを実行する。
また、複数の出力ピンが存在した場合、アクションの実行後にそれら全てのピンから出力される。

##### データストアノード

図8.2 では、「素子データ作成」から「ディスプレイ画像作成」へ素子データが流れた後でも、「保存用静止画作成」に「ディスプレイ画像作成」に流れたものと同様の「素子データ」を与えられることを図8.16 のように《datastore》の表記で表現している。
通常の場合、オブジェクトフロー上のオブジェクトは永続的にオブジェクトノードに留まり続けるわけではなく、刹那的なものである。
しかしデータストアノード(Data Store Node)を用いることで、オブジェクトが流れた後でも、そのオブジェクトノードにオブジェクトが残り続けることを表すことができる。

#### 分岐
##### デシジョンノード

図8.2 では、バッファの空きがあるかどうかによって、次に実行する処理が変わることを図8.17 のように表現している。
このように、フローが条件に応じて分岐することを表すモデル要素がデシジョンノード(Decision Node) である。
分岐の条件はガード(Guard) で指定する。
ガードはフローの脇に角括弧で括って表記する。

##### マージノード

複数のフローから1 つのフローに合流することを表すモデル要素がマージノード(MergeNode) である。
図8.3 では図8.18 のようにマージノードを使用してフローの合流を表現している。
マージノードに入力されるフローは後述するジョインノードとは違い、他のフローからの入力が揃うことを待たずに、次のノードに移行する。

##### フォークノード

図8.1 では、アクティビティ開始後、「素子初期化」アクションと「ディスプレイ初期化」アクションが同時並行で処理されることを図8.19 のように表現している。
このように、1 つの入力フローが複数の出力フローに分かれ、同時並行で処理を行なうことを表現するモデル要素が、フォークノード(Folk Node) である。

##### ジョインノード

8.1 では、「素子初期化」アクションと「企業ロゴ表示」アクションが両方終了することで初めて「イメージ生成」アクションの実行が開始されることを図8.20 のように表現している。
このように、複数のフロー全ての入力を待ってから1つのフローから出力し、並行処理の同期を行なうことを表現するモデル要素をジョインノード(Join Node) と呼ぶ。

#### イベントアクション
##### イベント受信アクション

図8.2 では、シャッターの押下を待つ処理を、図8.21 のように表現している。
このように、外部からのイベントの受信を待つアクションをイベント受信アクション(Accept EventAction) と呼ぶ。
イベント受信アクションを実行すると、イベントを受信するまで待ってから次のノードへ移行する。

##### シグナル送信アクション

8.2 では、「バッファフル」であることがわかった時、その通知をアクティビティの外部に通知するためシグナルを送信することを、図8.22 のように表現している。
このように、イベントが起きたことをアクティビティの外部に通知するシグナル送信を行なうアクションを、シグナル送信アクション(Send Signal Action) と呼ぶ。

##### 時間イベントアクション

図8.2 では、タイマーが1/30 秒おきに「ディスプレイ画像作成」を起動することを図8.23のように表現している。
このように、ある時間になったことで開始するアクションを時間イベントアクション(Time Event Action) と呼ぶ。

#### ストリーム

図8.2では、「素子データ作成」アクションが処理の実行中（実行の開始後）に「光」を入力として受け取り、また実行中（実行の終了前）に「素子データ」を出力していることを、図8.24のように表現している。
このように{stream}のように表記することでストリーム(Stream)の指定をできる。

通常の場合では、アクションは入力を受け付けると処理を開始し、その後改めて入力を受け付けることはない。
また、処理の終了後に全ての出力フローから出力される。
通常はアクションの実行中に出力されることはない。
しかし、ストリームはその原則を外れることを意味する。
ストリームが入力ピンや入力のアクティビティパラメータノードに付加された場合、処理の途中でパラメータを受け取れることを表す。
ストリームが出力ピンや出力のアクティビティパラメータノードに付加された場合、その出力は処理の終了を待つことなく出力できることを表す。
すなわちストリームは、アクションの開始時、終了時に限らず、パラメータの入出力が可能なことを意味する。

#### パーティション

アクティビティ図では、それぞれのアクションを実行する責務をどの要素が持つかをパーティション(ActivityPartition) を使って表すことができる。
パーティション名には、ブロック名やプロパティ名等の要素名を記述し、その要素が担当するアクションをそのパーティションに記述する。

図8.25 では、図8.2 の「ディスプレイ画像作成」から「ディスプレイ更新」までのフローを、パーティションを使って表現している。
パート・プロパティ「：画像エンジン」が「ディスプレイ画像作成」の処理を担当し、パート・プロパティ「：ディスプレイ」が「ディスプレイ更新」の処理を担当することを表現している。

### SysML 固有のモデル要素

本節では、SysML のアクティビティ図で利用可能なモデル要素のうち、UML には含まれないSysML 固有のモデル要素について解説する。

#### レート

##### レート

図8.2 では、「素子データ作成」アクションが「素子データ」を毎秒30 枚出力することを、図8.24 の「rate="30/s"」のような記述で表現している。
このように一定時間内に到着するオブジェクトの数やその期待値を表すモデル要素をレート(Rate) と呼ぶ。

レートがフローに適用された場合、一定時間内にそのフローに流れるオブジェクトの数や期待値を表す。
一方、レートが入出力ピンやアクティビティパラメータノードに適用される場合、一定時間内にそのパラメータに到着する、もしくは出力されるオブジェクトの数や期待値を表す。

しかし、レートは時間に対して不規則に変化するような場合には適用できない。
時間と共に変化する離散値には後述の離散(Discrete) を適用する。

##### 連続

図8.2 では、入力パラメータである「光」オブジェクトが絶え間なく連続的に入力ピンに到着し続けていることを、図8.26 のように≪ continuous ≫の表記で表現している。
このように、流れるオブジェクトの時間間隔がゼロであり、すなわち連続的に流れていることを表すモデル要素を連続(Continuous) と呼ぶ。

連続がフローに適用された場合、そのフローに流れるオブジェクトは連続的に流れていることを表す。
一方連続が入出力ピンやアクティビティパラメータノードに適用される場合、そのパラメータに到着する、もしくは出力されるオブジェクトは連続的に流れていることを表す。

##### 離散

8.2 では、出力パラメータである「位置情報」が連続(Continuous) でなく離散的に出力されていることを図8.27 のように≪ discrete ≫の表記で表現している。
このように、オブジェクトが離散的に流れることを表現するモデル要素を、離散(Discrete) と呼ぶ。

離散がフローに適用された場合、そのフローに流れるオブジェクトは離散的に流れていることを表す。
一方、離散が入出力ピンやアクティビティパラメータノードに適用される場合、そのパラメータに到着する、もしくは出力されるオブジェクトは離散的に流れていることを表す。

#### オプション

図8.2 では、「保存用静止画作成」アクションの入力パラメータ「位置情報」はオプションであり、「位置情報」の入力が無くともアクションが実行されることを図8.28 のように≪optional ≫の表記で表現している。
このように、入出力がオプションの位置付けであることを表現するモデル要素をオプション(Optional) と呼ぶ。

一方、図8.27 では出力がオプションの場合を示している。
図8.27 ではアクションの終了後、「位置情報」が出力されない場合があることをオプションで表している。

基本的にアクションは、入力フローから全て入力されたときに実行される。
そしてアクション終了時に全ての出力フローから出力される。
しかし、オプションが適用された場合その原則が適用されない。
オプションが入力パラメータに適用されている場合、その入力が無くてもアクションが実行できることを表す。
一方、出力パラメータに適用されている場合、アクション終了時にそのパラメータが必ずしも出力されない可能性を表す。

#### 確率

図8.29 は、図8.2 の一部分に対して確率についての情報を付加したモデルである。
付加された確率の情報は、10 秒間に4 回連続で静止画を保存した場合にどのくらいの確率でどのように分岐するかを表している。

図8.29 では、バッファがフルになっている確率は「probability=0.1」であり、10 ％あることを表している。
このように、フローの確率的な分岐を表すモデル要素を確率(Probability)と呼ぶ。
確率を用いる場合、同じデシジョンノードから出力されている全てのフローは確率を持っていなければならず、その総和は1 でなくてはならない。
確率はフローの近くに{probability=値} のように記述する。

#### バッファ関係
##### バッファなし

図8.2 では、「保存用画像」のためのバッファが一杯の場合、新たに到着した「保存用画像」オブジェクトを破棄することを図8.30 のように《noBuffer》の表記で表現している。
このように、既に一杯になっているバッファに対して新たなオブジェクトが到着した場合、そのオブジェクトを破棄することを表すモデル要素をバッファなし(No Buffer) と呼ぶ。

##### 上書き

図8.2 では、「ディスプレイ用画像」のバッファがフルになった場合、新たに到着したオブジェクトでバッファを上書きすることを図8.31 のように≪ overwrite ≫の表記で表現している。
このように、既にフルなっているバッファに対して、新たなオブジェクトが到着した場合、そのオブジェクトをバッファに上書きで残すことを表現するモデル要素を上書き(Overwrite) と呼ぶ。

#### 制御オペレータ

図8.2 では、「保存用静止画作成」アクションが「ディスプレイ画像作成」アクションの実行を有効化したり、無効化したりできることを図8.32 のように≪ controlOperator ≫の表記で表現している。
このように、図8.33 のように定義された制御値(Control Value) を用いて、他のアクションの実行を有効(enable) にしたり、無効(disable) にしたりするアクションを制御オペレータ(Control Operator) と呼ぶ。

図8.32 のように制御オペレータは制御値を用いることで、コントロールの意味を持ったデータを扱うことができる。
「{control}」はそのオブジェクトフローがコントロールの意味を持ったデータを流していることを示している。
制御オペレータは必ずパラメータに制御値を持たなければならない。
なお、制御オペレータ以外はパラメータに制御値を持つべきではない。

## パッケージ図

本章では、モデル要素群をグループ化し、より大きい粒度でシステムのモデル全体の構造を表現する、パッケージ図について解説する。

### パッケージ図とは

モデルに含まれる多数のモデル要素をグループ化し、扱いやすくするためにパッケージを用いることができる。
パッケージは多くのモデル要素を包含できる。
パッケージ図(PackageDiagram) は、パッケージやパッケージ間の関係を表現するためのダイアグラムである。

UML のパッケージ図と比べて特にSysML のパッケージ図では、ビューとビューポイントの表現を強化することでIEEE1471 標準との整合性を高めている。
ビューやビューポイントを使うことで、特定の利害関係者の観点から見てシステムの何が重要かを表現し、その利害関係者の観点から見たシステムの見え方を表現できる。

UML で利用可能なモデル要素であるパッケージマージ(Package Merge) は、あるパッケージの内容を別のパッケージに取り込み拡張するための機能を提供するが、SysML ではパッケージマージは除外されている。

### パッケージ図の例

図9.1 は、第8 章「アクティビティ図」で使用した題材である、GPS 内蔵デジタルカメラのモデル全体の構造を表現したパッケージ図である。

GPS 内蔵デジタルカメラのモデルを構成するモデル要素のほとんどは、「要求」「性能分析」等、図9.1 の左側に配置されたパッケージ群に包含されている。
図の右側に位置する「デジタルカメラビュー」パッケージは、ビューやビューポイントを使って、利害関係者の関心事に応じた情報をまとめるための特殊なパッケージである。

### UML と共通のモデル要素
##### パッケージ

図9.1 では、デジタルカメラのモデルを構成するモデル要素のうち、要求に関する要素をグループ化し、モデル要素を整理していることを図9.2 のように表現している。
このように、モデル要素をグループ化して整理するためのモデル要素をパッケージ(Package) と呼ぶ。

図9.2 に示すように、パッケージはフォルダのような表記で表される。

##### ネスト

図9.1 では、パッケージ「デジタルカメラビュー」に要素が含まれていることを、図9.3 のように表現している。
このような、パッケージとそれに包含される要素の関係を、通称ネストと呼ぶ。

図9.3 と表記は異なるが同様の意味を表現する図を、図9.4 に示す。

##### インポート

図9.1 では、「性能ビュー」パッケージが、「性能」要求と「性能分析」パッケージの要素を自パッケージの要素として取り込んでいることを図9.5 のように表現している。
このように、他パッケージの要素を自パッケージの要素として取り込むためのモデル要素が、インポート(Package Import, Element Import) である。

インポートは破線矢印にキーワード《import》を付加して表記する。矢印の向きは、要素を取り込むパッケージから、取り込まれる要素やパッケージに向けたものになる。

### SysML 固有のモデル要素

##### ビューポイント

9.1 では、性能に関心がある利害関係者の観点を図9.6 のように表現している。
このように、利害関係者の関心に即した観点を表現するモデル要素を、ビューポイント(Viewpoint)と呼ぶ。

一般に、システムに対して様々な利害関係者がそれぞれ異なる観点から関心を持っている。
ビューポイントは、そのような個々の観点についての情報をまとめて表現する。

図9.7 のように、ビューポイントにはその観点についての詳細を≪ viewpoint ≫区画にテキストで記載できる。
記載する項目は以下の通りである。

- 利害関係者(stakeholders)
- 目的(purpose)
- 関心事(concerns)
- 言語(languages)
- 手法(methods)

##### ビュー

図9.1 では、性能に関心がある利害関係者の観点から対象システムを見るためのパッケージを、図9.8 のように表現している。
このように、1つのビューポイントの観点からシステムを見るためのパッケージをビュー(View) と呼ぶ。

インポートの関係を使って、関心のある要素とビューとの関係を定義することによって、ビューポイントの観点からシステムのうちのどの要素に関心があるかを明確にできる。
言い換えると、ビューは1つのビューポイントに準拠して、ビューポイントに基づいた切り口でシステムを見えるようにする。

ビューは他のパッケージや他のビューをインポートできる。

##### 準拠

9.1 では、「性能ビュー」パッケージがビューポイント「性能ビューポイント」で定義された観点に基づいていることを図9.9 のように表現している。

準拠(Conform) はビューと、そのビューの観点を表現するビューポイントとの関係を表現するモデル要素である。

準拠は破線矢印にステレオタイプ名《conform》を付加して表記する。
矢印の向きは、ビューからビューポイントに向けている。

## 割り当て

本章では、システムのモデルを構成する各種モデル要素間の関係を表現するための要素である割り当てについて解説する。

### 割り当てとは

割り当て(Allocate) は様々なモデル要素間の関係を示すための要素である。
異なるダイアグラムに記載された2つのモデル要素がどのように関係しているかを表すために割り当てを利用できる。
割り当ては特定の手法に特化したものではなく、用途の多様性を重視した柔軟な概念である。

割り当ては、例えばアクティビティやアクション等の振る舞いが、内部ブロック図のどの要素に割り当てられているかを明示するために利用できる。
また抽象的なモデルから、より具体的なモデルへの関係を表すために用いることができる。

### 割り当ての例

本章では題材として、第8 章「アクティビティ図」で用いたデジタルカメラの一部を用いている。

図10.1 の左側に配置され、≪ activity ≫と表記された3 つのブロックはそれぞれ、第8 章「アクティビティ図」の題材のアクティビティ図で表現された3つのアクティビティに相当する。
デジタルカメラの主要動作を定義しているのがアクティビティ「動作概要」である。
図10.1 ではアクティビティ「動作概要」はアクティビティ「イメージ生成」を保持しており、またアクティビティ「動作概要」はブロック「デジタルカメラ」に割り当てられている。
アクティビティ「イメージ生成」はアクティビティ「保存用静止画作成」を保持しており、その振る舞いは「デジタルカメラ」のパート・プロパティ「画像エンジン」に割り当てられている。

図10.2 のアクティビティ図はアクティビティ「イメージ生成」の一部を抜粋したものである。
また図10.3 の内部ブロック図は図10.1 のブロック「デジタルカメラ」の内部を記述した内部ブロック図の一部で、ディスプレイの制御部分を示している。

アクティビティ「イメージ生成」のアクション「ディスプレイ画像作成」はパート・プロパティ「: 画像エンジン」に、アクション「ディスプレイ更新」はパート・プロパティ「: ディスプレイ」にそれぞれ割り当てられている。
また例示したアクティビティ図のオブジェクトフロー「of1」は、内部ブロック図のコネクタ「c1」に割り当てられている。

システムの開発を進めていく過程で、論理的な機能や構造の検討だけでなく、実際のハードウェア制約を反映した構造の再検討や、ハードウェアに対する機能の割り当て等、より具体的なレベルのモデルが必要になる。

図10.4 は図10.3 の内部ブロック図を、より具体的な内部ブロック図に割り当てている例である。
検討の過程で画像データを一時的に保存するバッファを用意することになり、オブジェクトフロー1つに対し2本のコネクタ(「c2」、「c3」) と1 つのパート・プロパティ(「:バッファ」) への割り当てを行なっている。

### 割り当ての各種表記
#### 矢印表記

割り当て関係は、破線矢印にステレオタイプ名《allocate》を付加して表現できる。
図10.1 では、アクティビティ「動作概要」をブロック「デジタルカメラ」に割り当てていることを図10.5 のように表している。
このように、割り当てを使って、矢印の元の要素が矢印の先の要素に割り当てられていることを表すことができる。
割り当ての対象はブロックには限らない。
いかなるモデル要素の組合せにも適用できる。

#### コールアウト表記

矢印での割り当て表記は同じ図の中の要素間の関係しか表すことができない。
しかし、ノートを用いて割り当てを表現することで、他の図の要素への割り当ても表すことができる。
このような表記方法をコールアウト表記と呼ぶ。

図10.6 は図10.2 からアクション「ディスプレイ画像作成」を抜粋した図であり、図10.7は図10.3 からパート・プロパティ「:画像エンジン」を抜粋した図である。
図10.2 のアクション「ディスプレイ画像作成」からのパート・プロパティ「:画像エンジン」への割り当てをコールアウト表記で表現している。

コールアウト表記で割り当てを記述する場合には、allocatedTo、allocatedFrom の表記で割り当て関係を表す。
allocatedTo は矢印表記でいえば矢印の先、allocatedFrom は矢印の元にあたる。
コールアウト表記では、割り当て関係のあるもう一方のモデル要素の種類と名前をノートに記述する。

「allocatedTo ≪ part ≫ 画像エンジン」はアクション「ディスプレイ画像作成」がパート・プロパティ「:画像エンジン」への割り当て関係を持っていることを表している。
一方、「allocatedFrom ≪ action ≫ディスプレイ画像作成」はパート・プロパティ「: 画像エンジン」がアクション「ディスプレイ画像作成」からの割り当て関係を持っていることを表している。

#### 区画表記

ブロックやアクションでは区画に、コールアウト表記と同様の割り当て関係を表現できる。

##### ブロックへの記述

図10.5 の割り当てを区画表記で表現したものが図10.8 である。
区画に記述する場合、allocatedFrom とallocatedTo の区画をそれぞれ設けて割り当て関係を記述する。
1つのブロックにallocatedFrom とallocatedTo 両方記述する場合はそれぞれの区画を設ける必要がある。

##### プロパティへの記述

ブロックの区画に記述する場合と同様に、内部ブロック図中のプロパティのallocatedFromとallocatedTo の区画に割り当て関係を記述できる。

##### アクションへの記述

ブロックの区画に記述する場合と同様に、アクティビティ図中のアクションのallocated-From とallocatedTo の区画に割り当て関係を記述できる。

#### パーティションへの割り当て

割り当てはアクティビティ図のパーティションを用いて記述できる。

図10.11 は図10.2 に記述したアクティビティ図にパーティションを適用し、それぞれのアクションがどのパート・プロパティに割り当てられるかを表したものである。
アクション「ディスプレイ画像作成」はパート・プロパティ「: 画像エンジン」に、アクション「ディスプレイ更新」はパート・プロパティ「: ディスプレイ」に割り当てられている。

#### コネクタ、フローとの割り当て

コネクタ、オブジェクトフローやアイテムフローといった区画を持たない要素に対しても割り当てを行なうことができる。
この場合、モデル要素に区画が存在しないので、コールアウト表記か矢印表記で割り当て関係を示すことになる。

図10.2 のof1 は、図10.3 のc1 に割り当てられている。
この割り当て関係はコールアウト形式で表現されている。

#### 表形式表現

表形式で要素間の割り当て関係を表現できる。
ただしSysML では表のフォーマットは規定していない。

表10.1 は図10.4 の割り当て関係を表形式で表現したものである。


